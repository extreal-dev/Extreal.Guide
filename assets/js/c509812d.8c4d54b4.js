"use strict";(self.webpackChunkextreal=self.webpackChunkextreal||[]).push([[5441],{3530:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>s,toc:()=>u});var t=i(9668),a=(i(6540),i(5680)),r=i(7443);const l={sidebar_position:10},o="SFU using OME",s={unversionedId:"integration/sfu.ome",id:"integration/sfu.ome",title:"SFU using OME",description:"What for?",source:"@site/docs/integration/sfu.ome.md",sourceDirName:"integration",slug:"/integration/sfu.ome",permalink:"/Extreal.Guide/next/integration/sfu.ome",draft:!1,tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"tutorialSidebar",previous:{title:"P2P using WebRTC",permalink:"/Extreal.Guide/next/integration/p2p.webrtc"},next:{title:"Sample Application",permalink:"/Extreal.Guide/next/category/sample-application"}},c={},u=[{value:"What for?",id:"what-for",level:2},{value:"Specification",id:"specification",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Unity",id:"unity",level:3},{value:"JavaScript",id:"javascript",level:3},{value:"Installation",id:"installation",level:2},{value:"Package",id:"package",level:3},{value:"Unity",id:"unity-1",level:4},{value:"npm",id:"npm",level:4},{value:"Dependencies",id:"dependencies",level:3},{value:"Unity",id:"unity-2",level:4},{value:"npm",id:"npm-1",level:4},{value:"Settings",id:"settings",level:3},{value:"OME\u30b5\u30fc\u30d0",id:"ome\u30b5\u30fc\u30d0",level:4},{value:"\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0",id:"\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0",level:4},{value:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3",id:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3",level:4},{value:"Usage",id:"usage",level:2},{value:"SFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3059\u308b",id:"sfu-ome-establish-connection",level:3},{value:"SFU\u306e\u72b6\u614b\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",id:"sfu\u306e\u72b6\u614b\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",level:3},{value:"Native(C#)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",id:"nativec\u306esfu\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",level:3},{value:"WebGL(JavaScript)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",id:"webgljavascript\u306esfu\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b",level:3}],g={toc:u},m="wrapper";function d(e){let{components:n,...i}=e;return(0,a.yg)(m,(0,t.A)({},g,i,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"sfu-using-ome"},"SFU using OME"),(0,a.yg)("h2",{id:"what-for"},"What for?"),(0,a.yg)("p",null,"\u30b3\u30b9\u30c8\u3092\u3067\u304d\u308b\u3060\u3051\u6291\u3048\u3066\u30d0\u30fc\u30c1\u30e3\u30eb\u7a7a\u9593\u7b49\u3067\u5927\u898f\u6a21\u306a\u30b3\u30df\u30e5\u30cb\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u53d6\u308b\u624b\u6bb5\u3068\u3057\u3066SFU(Selected Forwarding Unit)\u304c\u3042\u308a\u307e\u3059\u3002"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://airensoft.gitbook.io/ovenmediaengine/"},"OME(OvenMediaEngine)"),"\u3092\u6d3b\u7528\u3059\u308b\u3068\u6bd4\u8f03\u7684\u5bb9\u6613\u306bSFU\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u304c\u3001SFU\u306e\u63a5\u7d9a\u78ba\u7acb\u306f\u4f3c\u901a\u3063\u305f\u51e6\u7406\u306b\u306a\u308b\u306e\u3067\u5171\u901a\u6a5f\u80fd\u3068\u3057\u3066\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\u3053\u306e\u5171\u901a\u6a5f\u80fd\u3092\u4f7f\u3046\u3053\u3068\u3067\u30e1\u30c7\u30a3\u30a2\u30b9\u30c8\u30ea\u30fc\u30e0\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\u306e\u307f\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306eSFU\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002"),(0,a.yg)("p",null,"\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306fNative(C#)\u3068WebGL(JavaScript)\u5411\u3051\u306eSFU\u306e\u30d9\u30fc\u30b9\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002"),(0,a.yg)("h2",{id:"specification"},"Specification"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"SFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3067\u304d\u307e\u3059\u3002"),(0,a.yg)("li",{parentName:"ul"},"SFU\u306e\u72b6\u614b\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002"),(0,a.yg)("li",{parentName:"ul"},"Native(C#)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002"),(0,a.yg)("li",{parentName:"ul"},"WebGL(JavaScript)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002")),(0,a.yg)("h2",{id:"architecture"},"Architecture"),(0,a.yg)("h3",{id:"unity"},"Unity"),(0,a.yg)(r.K,{chart:"classDiagram\n\n    OmeClientProvider ..> OmeClient\n    OmeClient <|-- NativeOmeClient\n    OmeClient <|-- WebGLOmeClient\n    OmeClient ..> OmeConfig\n\n    class OmeClientProvider {\n        +Provide(omeConfig)$ OmeClient\n    }\n    \n    class OmeClient {\n        <<abstract>>\n        +OnJoined IObservable\n        +OnLeft IObservable\n        +OnUnexpectedLeft IObservable\n        +OnUserJoined IObservable\n        +OnUserLeft IObservable\n        +ListGroupsAsync() List\n        +JoinAsync(groupName) void\n        +LeaveAsync() void\n    }\n    \n    class OmeConfig {\n        +ServerUrl string\n        +IceServerConfigs List\n    }\n\n    class NativeOmeClient {\n    }\n    \n    class WebGLOmeClient {\n    }",mdxType:"Mermaid"}),(0,a.yg)("h3",{id:"javascript"},"JavaScript"),(0,a.yg)(r.K,{chart:"classDiagram\n\n    WebGLOmeClient ..> WebGLHelper  \n    OmeClient <.. WebGLHelper  \n    OmeAdapter ..> OmeClient\n\n    class WebGLOmeClient {\n        <<C#>>\n    }\n    \n    class WebGLHelper {\n        <<C#>>\n    }\n\n    class OmeAdapter {\n        <<TypeScript>>\n        +adapt() void\n    }\n    \n    class OmeClient {\n        +localClientId string\n        +releaseManagedResources() void\n        +addPublishPcCreateHook(hook) void\n        +addSubscribePcCreateHook(hook) void\n        +addPublishPcCloseHook(hook) void\n        +addSubscribePcCloseHook(hook) void\n        +listGroups() void\n        +join(groupName) void\n        +leave() void\n    }",mdxType:"Mermaid"}),(0,a.yg)("p",null,"OME\u3092\u4f7f\u7528\u3057\u305fSFU\u3067\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0\u3001OME\u30b5\u30fc\u30d0\u304c\u5354\u8abf\u3057\u3066SFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3057\u307e\u3059\u3002\n\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u306fSFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3059\u308b\u305f\u3081\u3001\u6b21\u306e\u51e6\u7406\u30d5\u30ed\u30fc\u3092\u60f3\u5b9a\u3057\u305f\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\npublish connection\u304a\u3088\u3073subscribe connection\u306f\u305d\u308c\u305e\u308cWebRTC\u3092\u7528\u3044\u305f\u500b\u5225\u306eP2P\u901a\u4fe1\u3067\u63a5\u7d9a\u3057\u3066\u3044\u307e\u3059\u3002"),(0,a.yg)(r.K,{chart:'sequenceDiagram\n    actor Client\n    participant Signaling\n    participant OME\n    actor ClientsAlreadyJoined\n\n    Client->>Signaling: list groups\n    Signaling--\x3e>Client: group list or empty list\n    Client->>Signaling: message "publish"\n    Signaling->>OME: message "request_offer"\n    OME->>Signaling: message with offer\n    Signaling->>Client: message "publish offer" with offer\n    Client->>Signaling: message "answer" with answer\n    Signaling->>OME: message "answer" with answer\n    note over Client, OME: Established publish connection \n    Client->>Signaling: message "join"\n    Signaling->>Client: message "join" for each client who has already joined\n    Client->>Signaling: message "subscribe" for each client who has already joined\n    Signaling->>OME: change only "publish offer" to "subscribe offer" and followed by "request_offer" to "answer" but omitted\n    note over Client, OME: Established subscribe connections for all clients who has already joined\n    Signaling->>ClientsAlreadyJoined: message "join" for Client\n    ClientsAlreadyJoined->>Signaling: message "subscribe" for Client\n    Signaling->>OME: change only "publish offer" to "subscribe offer" and followed by "request_offer" to "answer" but omitted\n    note over ClientsAlreadyJoined, OME: Established subscribe connection for Client',mdxType:"Mermaid"}),(0,a.yg)("h2",{id:"installation"},"Installation"),(0,a.yg)("h3",{id:"package"},"Package"),(0,a.yg)("h4",{id:"unity-1"},"Unity"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-text"},"https://github.com/extreal-dev/Extreal.Integration.SFU.OME.git\n")),(0,a.yg)("h4",{id:"npm"},"npm"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-text"},"@extreal-dev/extreal.integration.sfu.ome\n")),(0,a.yg)("h3",{id:"dependencies"},"Dependencies"),(0,a.yg)("p",null,"\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u6b21\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3044\u307e\u3059\u3002"),(0,a.yg)("h4",{id:"unity-2"},"Unity"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/Extreal.Guide/next/core/logging"},"Extreal.Core.Logging")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/Extreal.Guide/next/core/common"},"Extreal.Core.Common")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"/Extreal.Guide/next/integration/web.common"},"Extreal.Integration.Web.Common")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://docs.unity3d.com/Packages/com.unity.webrtc@3.0/manual/index.html"},"WebRTC")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://github.com/Cysharp/UniTask"},"UniTask")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://github.com/neuecc/UniRx"},"UniRx")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://github.com/endel/NativeWebSocket"},"NativeWebSocket"))),(0,a.yg)("h4",{id:"npm-1"},"npm"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("a",{parentName:"li",href:"https://www.npmjs.com/package/@extreal-dev/extreal.integration.web.common"},"@extreal-dev/extreal.integration.web.common"))),(0,a.yg)("h3",{id:"settings"},"Settings"),(0,a.yg)("h4",{id:"ome\u30b5\u30fc\u30d0"},"OME\u30b5\u30fc\u30d0"),(0,a.yg)("p",null,"OME\u30b5\u30fc\u30d0\u306f",(0,a.yg)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"Docker Compose"),"\u3067\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\n",(0,a.yg)("a",{parentName:"p",href:"https://github.com/extreal-dev/Extreal.Integration.SFU.OME/tree/main/OMEServer~"},"README"),"\u3092\u53c2\u7167\u3057\u3066OME\u30b5\u30fc\u30d0\u3092\u6e96\u5099\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,a.yg)("h4",{id:"\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0"},"\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0"),(0,a.yg)("p",null,"\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0\u306f",(0,a.yg)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"Docker Compose"),"\u3067\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\n",(0,a.yg)("a",{parentName:"p",href:"https://github.com/extreal-dev/Extreal.Integration.SFU.OME/tree/main/SignalingServer~"},"README"),"\u3092\u53c2\u7167\u3057\u3066\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0\u3092\u6e96\u5099\u3057\u3066\u304f\u3060\u3055\u3044\u3002"),(0,a.yg)("h4",{id:"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3"},"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3"),(0,a.yg)("p",null,"OmeClientProvider\u3092\u4f7f\u3063\u3066OmeClient\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nOmeClient\u306e\u4f5c\u6210\u6642\u306b\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0\u306eURL\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},'public class ClientControlScope : LifetimeScope\n{\n    protected override void Configure(IContainerBuilder builder)\n    {\n        var omeConfig = new OmeConfig("http://localhost:3040");\n        var omeClient = OmeClientProvider.Provide(omeConfig);\n        builder.RegisterComponent(omeClient);\n    }\n}\n')),(0,a.yg)("p",null,"WebGL\u3067\u4f7f\u3046\u5834\u5408\u306f\u3055\u3089\u306bJavaScript\u3067\u521d\u671f\u5316\u3092\u884c\u3044\u307e\u3059\u3002\nOmeAdapter\u3092\u4f5c\u6210\u3057\u3066adapt\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { OmeAdapter } from "@extreal-dev/extreal.integration.sfu.ome";\n\nconst omeAdapter = new OmeAdapter();\nomeAdapter.adapt();\n')),(0,a.yg)("h2",{id:"usage"},"Usage"),(0,a.yg)("h3",{id:"sfu-ome-establish-connection"},"SFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3059\u308b"),(0,a.yg)("p",null,"\u3053\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306fSFU\u63a5\u7d9a\u3092\u78ba\u7acb\u3059\u308b\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\n\u3053\u308c\u3089\u306e\u6a5f\u80fd\u306fOmeClient\u304c\u63d0\u4f9b\u3057\u307e\u3059\u3002"),(0,a.yg)("p",null,"\u307e\u305a\u540d\u524d\u3092\u6307\u5b9a\u3057\u3066\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3057\u307e\u3059\u3002\n\u307e\u3060\u540c\u3058\u540d\u524d\u306e\u30b0\u30eb\u30fc\u30d7\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u65b0\u305f\u306b\u4f5c\u6210\u3055\u308c\u3001\u5b58\u5728\u3059\u308b\u5834\u5408\u306b\u306f\u305d\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},'await omeClient.JoinAsync("group name");\n')),(0,a.yg)("p",null,"\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u9000\u51fa\u3059\u308b\u5834\u5408\u306fLeaveAsync\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},"await omeClient.LeaveAsync();\n")),(0,a.yg)("p",null,"\u73fe\u5728\u5b58\u5728\u3057\u3066\u3044\u308b\u30b0\u30eb\u30fc\u30d7\u306e\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u305f\u3044\u5834\u5408\u306fListGroupsAsync\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},"var groups = await omeClient.ListGroupsAsync();\n")),(0,a.yg)("h3",{id:"sfu\u306e\u72b6\u614b\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"},"SFU\u306e\u72b6\u614b\u3092\u30c8\u30ea\u30ac\u30fc\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"),(0,a.yg)("p",null,"OmeClient\u306f\u6b21\u306e\u30a4\u30d9\u30f3\u30c8\u901a\u77e5\u3092\u8a2d\u3051\u3066\u3044\u307e\u3059\u3002"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"OnJoined",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30df\u30f3\u30b0\uff1a\u30b0\u30eb\u30fc\u30d7\u306b\u53c2\u52a0\u3057\u305f\u76f4\u5f8c"),(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30d7\uff1aIObservable"),(0,a.yg)("li",{parentName:"ul"},"\u30d1\u30e9\u30e1\u30fc\u30bf\uff1a\u30e6\u30fc\u30b6\u30fc\u81ea\u8eab\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID"))),(0,a.yg)("li",{parentName:"ul"},"OnLeft",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30df\u30f3\u30b0\uff1a\u30b0\u30eb\u30fc\u30d7\u304b\u3089\u9000\u51fa\u3057\u305f\u76f4\u5f8c"),(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30d7\uff1aIObservable"),(0,a.yg)("li",{parentName:"ul"},"\u30d1\u30e9\u30e1\u30fc\u30bf\uff1a\u306a\u3057"))),(0,a.yg)("li",{parentName:"ul"},"OnUnexpectedLeft",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30df\u30f3\u30b0\uff1a\u30b7\u30b0\u30ca\u30ea\u30f3\u30b0\u30b5\u30fc\u30d0\u3068\u306e\u63a5\u7d9a\u304c\u5207\u65ad\u3055\u308c\u305f\u76f4\u5f8c"),(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30d7\uff1aIObservable"),(0,a.yg)("li",{parentName:"ul"},"\u30d1\u30e9\u30e1\u30fc\u30bf\uff1a\u5207\u65ad\u3055\u308c\u305f\u7406\u7531"))),(0,a.yg)("li",{parentName:"ul"},"OnUserJoined",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30df\u30f3\u30b0\uff1a\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3068\u63a5\u7d9a\u3057\u305f\u76f4\u5f8c",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u540c\u58eb\u304c\u304a\u4e92\u3044\u306b\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u65b0\u305f\u306b\u63a5\u7d9a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306f\u3001\u65e2\u306b\u63a5\u7d9a\u3057\u3066\u3044\u308b\u5168\u3066\u306e\u30e6\u30fc\u30b6\u30fc\u6570\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002"))),(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30d7\uff1aIObservable"),(0,a.yg)("li",{parentName:"ul"},"\u30d1\u30e9\u30e1\u30fc\u30bf\uff1a\u63a5\u7d9a\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID"))),(0,a.yg)("li",{parentName:"ul"},"OnUserLeft",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30df\u30f3\u30b0\uff1a\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3068\u5207\u65ad\u3057\u305f\u76f4\u5f8c"),(0,a.yg)("li",{parentName:"ul"},"\u30bf\u30a4\u30d7\uff1aIObservable"),(0,a.yg)("li",{parentName:"ul"},"\u30d1\u30e9\u30e1\u30fc\u30bf\uff1a\u5207\u65ad\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID")))),(0,a.yg)("h3",{id:"nativec\u306esfu\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"},"Native(C#)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"PeerConnection\u306eCreate/Close\u6642\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3067\u3082\u3001\u51e6\u7406\u304c\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002")),(0,a.yg)("p",null,"OmeClient\u306fpublish connection\u304a\u3088\u3073subscribe connection\u306e\u958b\u59cb\u6642\u3068\u7d42\u4e86\u6642\u306b\u51e6\u7406\u3092\u8ffd\u52a0\u3067\u304d\u308b\u30d5\u30c3\u30af\u3092\u8a2d\u3051\u3066\u3044\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},"omeClient.AddPublishPcCreateHook((id, rtcPeerConnection) =>\n{\n    // do something\n});\n\nomeClient.AddSubscribePcCreateHook((id, rtcPeerConnection) =>\n{\n    // do something\n});\n\nomeClient.AddPublishPcCloseHook((id) =>\n{\n    // do something\n});\n\nomeClient.AddSubscribePcCloseHook((id) =>\n{\n    // do something\n});\n")),(0,a.yg)("p",null,"\u3053\u308c\u3089\u306e\u30d5\u30c3\u30af\u3092\u4f7f\u3063\u3066\u30e1\u30c7\u30a3\u30a2\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u64cd\u4f5c\u3057\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u6a5f\u80fd\u3092SFU\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30aa\u30fc\u30c7\u30a3\u30aa\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306e\u5b9f\u88c5\u4f8b\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},'using System.Collections.Generic;\nusing System.Linq;\nusing Extreal.Core.Logging;\nusing Unity.WebRTC;\nusing UnityEngine;\n\nnamespace Extreal.Integration.SFU.OME.MVS.ClientControl\n{\n    public class NativeAudioStreamClient : AudioStreamClient\n    {\n        private static readonly ELogger Logger = LoggingManager.GetLogger(nameof(NativeAudioStreamClient));\n\n        private (AudioSource inAudio, AudioStreamTrack inTrack, MediaStream inStream) inResource;\n        private readonly Dictionary<string, (AudioSource outAudio, MediaStream outStream)> outResources = new Dictionary<string, (AudioSource, MediaStream)>();\n\n        private readonly Transform audioSourceContainer;\n\n        public NativeAudioStreamClient(NativeOmeClient omeClient)\n        {\n            audioSourceContainer = new GameObject(nameof(audioSourceContainer)).transform;\n            Object.DontDestroyOnLoad(audioSourceContainer);\n\n            omeClient.AddPublishPcCreateHook(CreatePublishPc);\n            omeClient.AddSubscribePcCreateHook(CreateSubscribePc);\n            omeClient.AddPublishPcCloseHook(ClosePublishPc);\n            omeClient.AddSubscribePcCloseHook(CloseSubscribePc);\n        }\n\n        private void CreatePublishPc(string clientId, RTCPeerConnection pc)\n        {\n            inResource.inAudio = new GameObject("InAudio").AddComponent<AudioSource>();\n            inResource.inAudio.transform.SetParent(audioSourceContainer);\n\n            inResource.inTrack = new AudioStreamTrack(inResource.inAudio)\n            {\n                Loopback = false\n            };\n            inResource.inStream = new MediaStream();\n            pc.AddTrack(inResource.inTrack, inResource.inStream);\n        }\n\n        private void CreateSubscribePc(string clientId, RTCPeerConnection pc) =>\n            pc.OnTrack = (RTCTrackEvent e) =>\n                {\n                    if (Logger.IsDebug())\n                    {\n                        Logger.LogDebug($"OnTrack: Kind={e.Track.Kind}");\n                    }\n                };\n\n        private void ClosePublishPc(string clientId)\n        {\n            if (inResource.inAudio != null)\n            {\n                inResource.inAudio.Stop();\n                Object.Destroy(inResource.inAudio.gameObject);\n            }\n            if (inResource.inTrack != null)\n            {\n                inResource.inTrack.Dispose();\n            }\n            if (inResource.inStream != null)\n            {\n                inResource.inStream.GetTracks().ToList().ForEach(track => track.Stop());\n                inResource.inStream.Dispose();\n            }\n            inResource = (default, default, default);\n        }\n\n        private void CloseSubscribePc(string clientId)\n        {\n        }\n\n        protected override void DoReleaseManagedResources()\n        {\n            if (audioSourceContainer != null && audioSourceContainer.gameObject != null)\n            {\n                Object.Destroy(audioSourceContainer.gameObject);\n            }\n        }\n    }\n}\n')),(0,a.yg)("h3",{id:"webgljavascript\u306esfu\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"},"WebGL(JavaScript)\u306eSFU\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b"),(0,a.yg)("admonition",{type:"caution"},(0,a.yg)("p",{parentName:"admonition"},"PeerConnection\u306eCreate/Close\u6642\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u3067\u3082\u3001\u51e6\u7406\u304c\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002")),(0,a.yg)("p",null,"WebGL(JavaScript)\u306e\u5834\u5408\u306fC#\u3068JavaScript\u306e\u9023\u643a\u304c\u5fc5\u8981\u306b\u306a\u308b\u305f\u3081\u3001Native(C#)\u306b\u6bd4\u3079\u308b\u3068\u5c11\u3057\u5927\u639b\u304b\u308a\u306a\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\n\u4ed5\u7d44\u307f\u306fNative(C#)\u3068\u540c\u3058\u3067\u30d5\u30c3\u30af\u3092\u4f7f\u3063\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092SFU\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002"),(0,a.yg)("p",null,"\u30aa\u30fc\u30c7\u30a3\u30aa\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306e\u5b9f\u88c5\u4f8b\u306f\u6b21\u306e\u901a\u308a\u3067\u3059\u3002\nOmeClientProvider\u3068\u3044\u3046\u95a2\u6570\u304b\u3089OmeClient\u3092\u53d6\u5f97\u3059\u308b\u90e8\u5206\u304c\u5927\u304d\u304f\u7570\u306a\u308a\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { OmeClientProvider } from "@extreal-dev/Extreal.Integration.SFU.OME";\n\nclass InResource {\n    public inStream: MediaStream | undefined;\n    public inTrack: MediaStreamTrack | undefined;\n}\n\nclass AudioStreamClient {\n    private readonly label: string = "sample";\n    private readonly isDebug: boolean;\n    private readonly getOmeClient: OmeClientProvider;\n\n    private inResource: InResource | undefined;\n\n    constructor(getOmeClient: OmeClientProvider) {\n        this.isDebug = true;\n        this.getOmeClient = getOmeClient;\n        this.getOmeClient().addPublishPcCreateHook(this.createPublishPc);\n        this.getOmeClient().addSubscribePcCreateHook(this.createSubscribePc);\n        this.getOmeClient().addPublishPcCloseHook(this.closePublishPc);\n        this.getOmeClient().addSubscribePcCloseHook(this.closeSubscribePc);\n    }\n\n    private createPublishPc = (clientId: string, pc: RTCPeerConnection) => {\n        this.inResource = new InResource();\n\n        const audioContext = new AudioContext();\n        const gainNode = audioContext.createGain();\n        gainNode.gain.setValueAtTime(0, audioContext.currentTime);\n\n        const destination = audioContext.createMediaStreamDestination();\n        gainNode.connect(destination);\n\n        const inStream = destination.stream;\n        const inTrack = inStream.getAudioTracks()[0];\n        this.inResource.inStream = inStream;\n        this.inResource.inTrack = inTrack;\n\n        pc.addTrack(this.inResource.inTrack, this.inResource.inStream);\n    };\n\n    private createSubscribePc = (clientId: string, pc: RTCPeerConnection) => {\n        pc.addEventListener("track", (event) => {\n            if (this.isDebug) {\n                console.log(`OnTrack: Kind=${event.track.kind}`);\n            }\n        });\n    };\n\n    private closePublishPc = (clientId: string) => {\n        this.inResource = undefined;\n    };\n\n    private closeSubscribePc = (clientId: string) => {};\n}\n\nexport { AudioStreamClient };\n')),(0,a.yg)("p",null,"OmeClientProvider\u306f",(0,a.yg)("a",{parentName:"p",href:"#settings"},"Settings"),"\u3067\u767b\u5834\u3057\u305fOmeAdapter\u304c\u63d0\u4f9b\u3057\u307e\u3059\u3002\nOmeAdapter\u306f\u5185\u90e8\u3067OmeClient\u3092\u4fdd\u6301\u3057\u3001C#\u3068JavaScript\u306e\u76f8\u4e92\u4f5c\u7528\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002"),(0,a.yg)("p",null,"WebGL\u3067SFU\u3092\u884c\u3046\u5834\u5408\u306f\u307e\u305aOmeAdapter\u3092\u4f5c\u6210\u3057\u3066adapt\u95a2\u6570\u3092\u547c\u3073\u51fa\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066OmeAdapter\u306egetOmeClient\u95a2\u6570\u3092\u4f7f\u3063\u3066\u5148\u307b\u3069\u306eAudioStreamClient\u306e\u3088\u3046\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002"),(0,a.yg)("p",null,"\u3053\u3053\u3067\u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\u51e6\u7406\u3092\u547c\u3073\u51fa\u3059\u30bf\u30a4\u30df\u30f3\u30b0\u304c\u91cd\u8981\u306b\u306a\u308a\u307e\u3059\u3002\nC#\u306eOmeClient\u3088\u308a\u5148\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u8ffd\u52a0\u3057\u305f\u51e6\u7406\uff08\u4eca\u56de\u3067\u3042\u308c\u3070AudioStreamClient\uff09\u304c\u521d\u671f\u5316\u3055\u308c\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nC#\u306eOmeClient\u306fOmeClientProvider\u306eProvide\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u305f\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u521d\u671f\u5316\u3055\u308c\u307e\u3059\u3002"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"/Extreal.Guide/next/integration/web.common"},"Web.Common"),"\u3092\u4f7f\u3063\u3066C#\u304b\u3089\u306e\u547c\u3073\u51fa\u3057\u30bf\u30a4\u30df\u30f3\u30b0\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-typescript"},'import { addAction } from "@extreal-dev/extreal.integration.web.common";\nimport { OmeAdapter } from "@extreal-dev/Extreal.Integration.SFU.OME";\nimport { AudioStreamClient } from "./AudioStreamClient";\nimport { DummyClient } from "./DummyClient";\n\n\nconst omeAdapter = new OmeAdapter();\nomeAdapter.adapt();\n\nlet audioStreamClient: AudioStreamClient;\naddAction("start", () => audioStreamClient = new AudioStreamClient(omeAdapter.getOmeClient));\naddAction("dummyhook", () => DummyClient.dummyHook(omeAdapter.getOmeClient));\n')),(0,a.yg)("p",null,"C#\u306e\u547c\u3073\u51fa\u3057\u5074\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n",(0,a.yg)("a",{parentName:"p",href:"/Extreal.Guide/next/integration/web.common"},"Web.Common"),"\u306eWebGLHelper\u3092\u4f7f\u3044\u307e\u3059\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-csharp"},'using Extreal.Integration.Web.Common;\n\nnamespace Extreal.Integration.SFU.OME.MVS.ClientControl\n{\n    public class WebGLAudioStreamClient : AudioStreamClient\n    {\n        public WebGLAudioStreamClient() => WebGLHelper.CallAction("start");\n    }\n}\n')))}d.isMDXComponent=!0}}]);