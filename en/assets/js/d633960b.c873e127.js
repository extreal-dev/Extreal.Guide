"use strict";(self.webpackChunkextreal=self.webpackChunkextreal||[]).push([[8408],{9864:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>l});var t=n(7624),r=n(5788);const a={sidebar_position:3},i="Asset Workflow using Addressables",o={id:"integration/asset-workflow.addressables",title:"Asset Workflow using Addressables",description:"What for?",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-1.2.0/integration/asset-workflow.addressables.md",sourceDirName:"integration",slug:"/integration/asset-workflow.addressables",permalink:"/Extreal.Guide/en/integration/asset-workflow.addressables",draft:!1,unlisted:!1,tags:[],version:"1.2.0",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Multiplay using Netcode for GameObjects",permalink:"/Extreal.Guide/en/integration/multiplay.ngo"},next:{title:"Common for Web",permalink:"/Extreal.Guide/en/integration/web.common"}},d={},l=[{value:"What for?",id:"what-for",level:2},{value:"Specification",id:"specification",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Addressables wrapper",id:"addressables-wrapper",level:3},{value:"Addressables customization",id:"addressables-customization",level:3},{value:"Installation",id:"installation",level:2},{value:"Package",id:"package",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Settings",id:"settings",level:3},{value:"Usage",id:"usage",level:2},{value:"Use Addressables features",id:"use-addressables-features",level:3},{value:"Reconnect when asset downloads fail to connect",id:"assets-addressables-retry",level:3},{value:"Add processing triggered by asset download state",id:"assets-addressables-event",level:3},{value:"Encrypt and decrypt assets",id:"assets-addressables-crypto",level:3}];function c(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.MN)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"asset-workflow-using-addressables",children:"Asset Workflow using Addressables"}),"\n",(0,t.jsx)(s.h2,{id:"what-for",children:"What for?"}),"\n",(0,t.jsxs)(s.p,{children:["We provide a wrapper that makes ",(0,t.jsx)(s.a,{href:"https://docs.unity3d.com/Packages/com.unity.addressables@1.21/manual/index.html",children:"Addressables"})," easier to use in applications."]}),"\n",(0,t.jsx)(s.p,{children:"We will call this feature, which wraps Addressables, the Addressables wrapper."}),"\n",(0,t.jsx)(s.p,{children:"The Addressables wrapper provides features to facilitate the creation of download status displays and asset encryption/decryption, which are necessary for applications using Addressables."}),"\n",(0,t.jsx)(s.p,{children:"The goal is to make Addressables introduction smooth by using the Addressables wrapper in your applications."}),"\n",(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsxs)(s.p,{children:["The  wrapper makes Addressables easier to use, but it does not mean that you only need to know the Addressables wrapper to realize asset workflow without knowing Addressables.\nThe Addressables wrapper compensates for the difficulties and lack of features when using Addressables as it is, but transfers the asset workflow processing to Addressables.\nTherefore, to use the Addressables wrapper, it is assumed that you know Addressables.\nIf you do not know Addressables, please refer to ",(0,t.jsx)(s.a,{href:"/Extreal.Guide/en/learning/intro#asset-workflow",children:"Learning"})," to learn about Addressables.\nThis guide assumes you know Addressables."]})}),"\n",(0,t.jsx)(s.h2,{id:"specification",children:"Specification"}),"\n",(0,t.jsx)(s.p,{children:"The specifications of the Addressables wrapper are as follows."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"You can use Addressables features."}),"\n",(0,t.jsx)(s.li,{children:"Reconnect when asset downloads fail to connect."}),"\n",(0,t.jsx)(s.li,{children:"You can add processing triggered by asset download state."}),"\n",(0,t.jsx)(s.li,{children:"You can encrypt and decrypt assets."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(s.h3,{id:"addressables-wrapper",children:"Addressables wrapper"}),"\n",(0,t.jsx)(s.mermaid,{chart:"classDiagram\n\n    AssetProvider ..> AssetDisposable\n    AssetProvider ..> Addressables\n    AssetDisposable ..> Addressables\n    DisposableBase <|-- AssetProvider\n    DisposableBase <|-- AssetDisposable\n\n    class AssetProvider {\n        +OnDownloading IObservable\n        +OnDownloaded IObservable\n        +OnConnectRetrying IObservable\n        +OnConnectRetried IObservable\n        +AssetProvider(retryStrategy)\n        +DownloadAsync(assetName, downloadStatusInterval, nextFunc) void\n        +GetDownloadSizeAsync(assetName) long\n        +LoadAssetAsync(assetName) AssetDisposable\n        +LoadAssetAsync() AssetDisposable\n        +LoadSceneAsync(assetName, loadMode) AssetDisposable\n    }\n\n    class AssetDisposable {\n        +Result TResult\n    }\n\n    class DisposableBase {\n        <<extreal>>\n    }\n    \n    class Addressables {\n        <<Addressables>>\n    }"}),"\n",(0,t.jsx)(s.h3,{id:"addressables-customization",children:"Addressables customization"}),"\n",(0,t.jsx)(s.mermaid,{chart:"classDiagram\n\n    BuildScriptBase <|-- BuildScriptEncryptMode\n    ResourceProviderBase <|-- CryptoAssetBundleProviderBase\n    IAssetBundleResource <|.. CryptoAssetBundleResource\n    DownloadHandlerScript <|-- DownloadHandlerFileWithDecryption\n    BuildScriptEncryptMode ..> ICryptoStreamFactory\n    CryptoAssetBundleProviderBase ..> ICryptoStreamFactory\n    CryptoAssetBundleResource ..> ICryptoStreamFactory\n    DownloadHandlerFileWithDecryption ..> ICryptoStreamFactory\n    CryptoAssetBundleProviderBase ..> CryptoAssetBundleResource\n    CryptoAssetBundleResource ..> DownloadHandlerFileWithDecryption\n\n    class ResourceProviderBase {\n        <<ResourceManager>>\n    }\n    \n    class CryptoAssetBundleProviderBase {\n    }\n    \n    class IAssetBundleResource {\n        <<ResourceManager>>\n    }\n\n    class CryptoAssetBundleResource {\n    }\n\n    class DownloadHandlerScript {\n        <<Networking>>\n    }\n\n    class DownloadHandlerFileWithDecryption {\n    }\n\n    class ICryptoStreamFactory {\n        <<interface>>\n        +CreateEncryptStream(baseStream, options) CryptoStream\n        +CreateDecryptStream(baseStream, options) CryptoStream\n    }\n    \n    class BuildScriptBase {\n        <<Addressables>>\n    }\n    \n    class BuildScriptEncryptMode {\n        <<editor>>\n    }"}),"\n",(0,t.jsx)(s.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(s.h3,{id:"package",children:"Package"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-text",children:"https://github.com/extreal-dev/Extreal.Integration.AssetWorkflow.Addressables.git\n"})}),"\n",(0,t.jsx)(s.admonition,{type:"info",children:(0,t.jsxs)(s.p,{children:["Asset encryption and decryption feature is not available in WebGL, so we separated out the assembly definition and excluded WebGL from the platform so that it would not be compiled when building for the WebGL platform. Therefore, if you want to use the asset encryption and decryption feature, please add ",(0,t.jsx)(s.code,{children:"Extreal.Integration.AssetWorkflow.Addressables.Custom.ResourceProviders"})," to the Assembly Definition."]})}),"\n",(0,t.jsx)(s.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsx)(s.p,{children:"The Addressables wrapper uses the following packages."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"/Extreal.Guide/en/core/logging",children:"Extreal.Core.Logging"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"/Extreal.Guide/en/core/common",children:"Extreal.Core.Common"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://docs.unity3d.com/Packages/com.unity.addressables@1.21/manual/index.html",children:"Addressables"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/Cysharp/UniTask",children:"UniTask"})}),"\n",(0,t.jsx)(s.li,{children:(0,t.jsx)(s.a,{href:"https://github.com/neuecc/UniRx",children:"UniRx"})}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Please refer to ",(0,t.jsx)(s.a,{href:"../category/release",children:"Release"})," for the correspondence between module version and each package version."]}),"\n",(0,t.jsx)(s.h3,{id:"settings",children:"Settings"}),"\n",(0,t.jsxs)(s.p,{children:["There are no special settings when used by default.\nSee ",(0,t.jsx)(s.a,{href:"#assets-addressables-crypto",children:"encryption and decryption"})," for encryption and decryption of assets."]}),"\n",(0,t.jsx)(s.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(s.h3,{id:"use-addressables-features",children:"Use Addressables features"}),"\n",(0,t.jsx)(s.p,{children:"The features of Addressables are provided by the AssetProvider class.\nFeatures not provided by AssetProvider should be implemented directly using Addressables."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:"var assetProvider = new AssetProvider();\n"})}),"\n",(0,t.jsx)(s.p,{children:"Here are some basic uses of AssetProvider."}),"\n",(0,t.jsx)(s.p,{children:"Use the GetDownloadSizeAsync method to get the download size."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'var size = await assetProvider.GetDownloadSizeAsync("AssetName");\n'})}),"\n",(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsxs)(s.p,{children:["AssetProvider.GetDownloadSizeAsync method returns 0 if the asset is cached, while the AssetProvider,\n2022.1+ and when used on the WebGL platform, it returns the file size even if the asset is cached.\nThis behavior is due to the specification of the Addressables.GetDownloadSizeAsync method. For more information ",(0,t.jsx)(s.a,{href:"https://forum.unity.com/threads/in-2022-2-xx-webgl-builds-getdownloadsizeasync-does-not-reflect-the-cache.1440877/",children:"Unity Forum"}),"."]})}),"\n",(0,t.jsx)(s.p,{children:"Use the DownloadAsync method to download assets."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'assetProvider.DownloadAsync("AssetName").Forget();\n'})}),"\n",(0,t.jsx)(s.p,{children:"You can also specify post-download processing, such as loading assets after downloading and then transitioning to the next stage."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'Func<UniTask> navigate = async () =>\n{\n    MessageConfig = await LoadAsync<MessageConfig>();\n    stageNavigator.ReplaceAsync(nextStage).Forget();\n};\nassetProvider.DownloadAsync("AssetName", nextFunc: navigate).Forget();\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.a,{href:"#assets-addressables-event",children:"event notification"})," if you want to run processing based on the download status."]}),"\n",(0,t.jsx)(s.p,{children:"Use the LoadAssetAsync method to load an asset."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'using var assetDisposable = await assetProvider.LoadAssetAsync<GameObject>("AssetName");\nvar prefab = assetDisposable.Result;\n'})}),"\n",(0,t.jsx)(s.p,{children:"Methods that load assets or scenes return AssetDisposable.\nAssetDisposable is a class that enables the release of loaded assets with IDisposable's Dispose.\nAssetDisposable handles an asset in the same way as other classes that implement IDisposable.\nLoaded asset is obtained from the Result property of AssetDisposable."}),"\n",(0,t.jsx)(s.p,{children:"If you use the type name as the asset name, such as ScriptableObject, you can load an asset without specifying the asset name."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'// Asset name: "ChatConfig"\nusing var assetDisposable = await assetProvider.LoadAssetAsync<ChatConfig>();\nvar chatConfig = assetDisposable.Result;\n'})}),"\n",(0,t.jsx)(s.p,{children:"Use the LoadSceneAsync method to load a scene."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'using var assetDisposable = await assetProvider.LoadSceneAsync("VirtualSpace");\nvar sceneInstance = assetDisposable.Result;\n'})}),"\n",(0,t.jsx)(s.h3,{id:"assets-addressables-retry",children:"Reconnect when asset downloads fail to connect"}),"\n",(0,t.jsxs)(s.p,{children:["AssetProvider uses the retry processing provided by ",(0,t.jsx)(s.a,{href:"/Extreal.Guide/en/core/common",children:"Common"})," to reconnect when communication is disconnected.\nThe following description assumes that you are familiar with the retry processing, so if you have not checked the retry processing, please check the ",(0,t.jsx)(s.a,{href:"/Extreal.Guide/en/core/common#core-common-retry",children:"retry processing"})," first."]}),"\n",(0,t.jsx)(s.p,{children:"AssetProvider does not reconnect by default.\nSpecifying a retry strategy in the AssetProvider constructor will reconnect."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:"var assetProvider = new AssetProvider(new CountingRetryStrategy());\n"})}),"\n",(0,t.jsx)(s.p,{children:"The reconnection processing handled by AssetProvider is as follows."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["When to run reconnection","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["If the asset download failed","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"This includes cases where asset loading fails, since downloading occurs even when an asset is loaded without having downloaded the asset."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["Reconnection processing details","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["If the asset download failed","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Repeat the connection according to the retry strategy."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.a,{href:"#assets-addressables-event",children:"event notifications"})," if you want to run processing based on the status of retry processing."]}),"\n",(0,t.jsx)(s.h3,{id:"assets-addressables-event",children:"Add processing triggered by asset download state"}),"\n",(0,t.jsx)(s.p,{children:"AssetProvider has the following event notifications."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["OnDownloading","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Timing\uff1aJust before downloading"}),"\n",(0,t.jsx)(s.li,{children:"Type\uff1aIObservable"}),"\n",(0,t.jsx)(s.li,{children:"Parameters\uff1aAsset name"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["OnDownloaded","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Timing\uff1aImmediately after download (including during processing)"}),"\n",(0,t.jsx)(s.li,{children:"Type\uff1aIObservable"}),"\n",(0,t.jsxs)(s.li,{children:["Parameters\uff1aDownload status","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Asset name, total bytes, downloaded bytes, percentages, etc."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["OnConnectRetrying","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Timing\uff1aJust before retrying the connection"}),"\n",(0,t.jsx)(s.li,{children:"Type\uff1aIObservable"}),"\n",(0,t.jsxs)(s.li,{children:["Parameters\uff1aRetry count","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["The first time is ",(0,t.jsx)(s.code,{children:"1"})," and the second time is ",(0,t.jsx)(s.code,{children:"2"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"1"})," means the start of retry strategy running."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["OnConnectRetried","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Timing\uff1aImmediately after connection retry is finished","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"If the retry is canceled, it will not be notified."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.li,{children:"Type\uff1aIObservable"}),"\n",(0,t.jsxs)(s.li,{children:["Parameters\uff1aRetry result","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"true: If the retry strategy is run and the retry is successful"}),"\n",(0,t.jsx)(s.li,{children:"false: If the retry strategy is run and the retry is not successful finally"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"assets-addressables-crypto",children:"Encrypt and decrypt assets"}),"\n",(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsx)(s.p,{children:"This feature is not available in WebGL."})}),"\n",(0,t.jsxs)(s.admonition,{type:"caution",children:[(0,t.jsx)(s.p,{children:"Note that using this feature alone is weak protection for intellectual property."}),(0,t.jsx)(s.p,{children:"By using this feature, if someone obtains only encrypted assets, they will not be able to decrypt them.\nFor example, even if the URL of the asset download destination is known, the asset cannot be decrypted, thus preventing misappropriation of the asset."}),(0,t.jsx)(s.p,{children:"However, if the encryption algorithm and the key used for decryption (implementation of ICryptoStreamFactory) are embedded in the application, the information necessary for decryption can be accessed and decrypted through reverse engineering.\nTherefore, for the purpose of intellectual property protection, it is necessary to prevent decryption from the application by reverse engineering in addition to this feature."})]}),"\n",(0,t.jsx)(s.p,{children:"Customize Addressables build scripts and ResourceProvider to encrypt and decrypt assets.\nThe following classes are provided."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Build script to encrypt assets","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"BuildScriptEncryptMode"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["ResourceProvider to decrypt assets","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"CryptoAssetBundleProviderBase"}),"\n",(0,t.jsx)(s.li,{children:"CryptoAssetBundleResource"}),"\n",(0,t.jsx)(s.li,{children:"DownloadHandlerFileWithDecryption"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["Factory that creates the CryptoStream used to encrypt and decrypt the asset","\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"ICryptoStreamFactory"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"These classes are related as follows."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Since the cryptographic algorithm to be used and the management of keys vary depending on the security level required by the application, an ICryptoStreamFactory is provided to implement for their processing."}),"\n",(0,t.jsx)(s.li,{children:"To embed ICryptoStreamFactory, CryptoAssetBundleProviderBase is provided as a Base class."}),"\n",(0,t.jsx)(s.li,{children:"CryptoAssetBundleProviderBase decrypts assets using ICryptoStreamFactory. (Actually CryptoAssetBundleResource and DownloadHandlerFileWithDecryption do it)"}),"\n",(0,t.jsx)(s.li,{children:"BuildScriptEncryptMode encrypts using ICryptoStreamFactory if the ResourceProvider specified in the Asset Group at build execution is a class that extends CryptoAssetBundleProviderBase, and Otherwise, encryption is not executed."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The following is an instruction on how to apply this feature."}),"\n",(0,t.jsx)(s.p,{children:"First, set up a build script to encrypt the assets as follows."}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Create a ScriptableObject from the ",(0,t.jsx)(s.code,{children:"Extreal > Integration.AssetWorkflow.Addressables.Editor > Encrypt Build Script"})," in the Create Asset menu."]}),"\n",(0,t.jsxs)(s.li,{children:["Add the ScriptableObject you created to the ",(0,t.jsx)(s.code,{children:"Build and Play Mode Scripts"})," from the ",(0,t.jsx)(s.code,{children:"AddressablesAssetSettings"})," inspector."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["This setting allows you to choose ",(0,t.jsx)(s.code,{children:"Build > New Build > Encrypt Build Script"})," in the ",(0,t.jsx)(s.code,{children:"Addressables Group"})," window."]}),"\n",(0,t.jsx)(s.p,{children:"Next, set up the ResourceProvider that decrypts the asset.\nICryptoStreamFactory must be implemented first.\nImplement ICryptoStreamFactory according to the requirements of your application.\nAn example implementation using AES is shown below to give an idea of the implementation."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'public class CryptoStreamFactory : ICryptoStreamFactory\n{\n    public CryptoStream CreateEncryptStream(Stream baseStream, AssetBundleRequestOptions options)\n        => CreateCryptoStream(baseStream, options, CryptoStreamMode.Write);\n\n    public CryptoStream CreateDecryptStream(Stream baseStream, AssetBundleRequestOptions options)\n        => CreateCryptoStream(baseStream, options, CryptoStreamMode.Read);\n\n    private static CryptoStream CreateCryptoStream\n    (\n        Stream baseStream,\n        AssetBundleRequestOptions options,\n        CryptoStreamMode mode\n    )\n    {\n        using var aes = CreateAesManaged(options);\n        var cryptor = mode == CryptoStreamMode.Write ? aes.CreateEncryptor() : aes.CreateDecryptor();\n        return new CryptoStream(baseStream, cryptor, mode);\n    }\n\n    [SuppressMessage("Usage", "CC0022")]\n    private static AesManaged CreateAesManaged(AssetBundleRequestOptions options)\n    {\n        const int keyLength = 128;\n        var salt = Encoding.UTF8.GetBytes(options.BundleName);\n\n        using var keyGen = new Rfc2898DeriveBytes(SecretVariables.CryptAssetPassword, salt, 100, HashAlgorithmName.SHA256);\n        using var ivGen = new Rfc2898DeriveBytes(SecretVariables.CryptAssetIv, salt, 1, HashAlgorithmName.SHA256);\n\n        var key = keyGen.GetBytes(keyLength / 8);\n        var iv = ivGen.GetBytes(keyLength / 8);\n\n        return new AesManaged\n        {\n            BlockSize = keyLength,\n            KeySize = keyLength,\n            Mode = CipherMode.CBC,\n            Padding = PaddingMode.PKCS7,\n            Key = key,\n            IV = iv\n        };\n    }\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"Implement a class that extends CryptoAssetBundleProviderBase.\nReturn a class that implements ICryptoStreamFactory."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-csharp",children:'[DisplayName("Crypto AssetBundle Provider")]\npublic class CryptoAssetBundleProvider : CryptoAssetBundleProviderBase\n{\n    public override ICryptoStreamFactory CryptoStreamFactory => new CryptoStreamFactory();\n}\n'})}),"\n",(0,t.jsxs)(s.p,{children:["Now you can select the implemented class as the ",(0,t.jsx)(s.code,{children:"Content Packing & Loading > Advanced Options > Asset Bundle Provider"})," from the inspector of the ",(0,t.jsx)(s.code,{children:"Addressables Asset Group"}),"."]})]})}function h(e={}){const{wrapper:s}={...(0,r.MN)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},5788:(e,s,n)=>{n.d(s,{MN:()=>l});var t=n(1504);function r(e,s,n){return s in e?Object.defineProperty(e,s,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[s]=n,e}function a(e,s){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);s&&(t=t.filter((function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var s=1;s<arguments.length;s++){var n=null!=arguments[s]?arguments[s]:{};s%2?a(Object(n),!0).forEach((function(s){r(e,s,n[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))}))}return e}function o(e,s){if(null==e)return{};var n,t,r=function(e,s){if(null==e)return{};var n,t,r={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],s.indexOf(n)>=0||(r[n]=e[n]);return r}(e,s);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],s.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var d=t.createContext({}),l=function(e){var s=t.useContext(d),n=s;return e&&(n="function"==typeof e?e(s):i(i({},s),e)),n},c={inlineCode:"code",wrapper:function(e){var s=e.children;return t.createElement(t.Fragment,{},s)}},h=t.forwardRef((function(e,s){var n=e.components,r=e.mdxType,a=e.originalType,d=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),p=l(n),u=r,y=p["".concat(d,".").concat(u)]||p[u]||c[u]||a;return n?t.createElement(y,i(i({ref:s},h),{},{components:n})):t.createElement(y,i({ref:s},h))}));h.displayName="MDXCreateElement"}}]);