"use strict";(self.webpackChunkextreal=self.webpackChunkextreal||[]).push([[2072],{9468:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var r=t(7624),i=t(5788);const s={sidebar_position:2},a="Multiplay using Netcode for GameObjects",o={id:"integration/multiplay.ngo",title:"Multiplay using Netcode for GameObjects",description:"What for?",source:"@site/i18n/en/docusaurus-plugin-content-docs/current/integration/multiplay.ngo.md",sourceDirName:"integration",slug:"/integration/multiplay.ngo",permalink:"/Extreal.Guide/en/next/integration/multiplay.ngo",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Chat using Vivox",permalink:"/Extreal.Guide/en/next/integration/chat.vivox"},next:{title:"Asset Workflow using Addressables",permalink:"/Extreal.Guide/en/next/integration/asset-workflow.addressables"}},l={},c=[{value:"What for?",id:"what-for",level:2},{value:"Specification",id:"specification",level:2},{value:"Architecture",id:"architecture",level:2},{value:"NGO wrapper",id:"ngo-wrapper",level:3},{value:"WebRtcTransport",id:"webrtctransport",level:3},{value:"Unity",id:"unity",level:4},{value:"JavaScript",id:"javascript",level:4},{value:"Installation",id:"installation",level:2},{value:"Package",id:"package",level:3},{value:"Unity",id:"unity-1",level:4},{value:"npm",id:"npm",level:4},{value:"Dependencies",id:"dependencies",level:3},{value:"Unity",id:"unity-2",level:4},{value:"npm",id:"npm-1",level:4},{value:"Settings",id:"settings",level:3},{value:"NGO wrapper",id:"ngo-wrapper-1",level:4},{value:"WebRtcTransport",id:"mulitplay-ngo-settings-webrtctransport",level:4},{value:"Usage",id:"usage",level:2},{value:"Use features for NGO servers/hosts",id:"mulitplay-ngo-server-host",level:3},{value:"Add a processing triggered by NGO server/host state",id:"add-a-processing-triggered-by-ngo-serverhost-state",level:3},{value:"Use features for NGO clients",id:"use-features-for-ngo-clients",level:3},{value:"Reconnect when NGO client communication is disconnected",id:"multiplay-ngo-retry",level:3},{value:"Add a processing triggered by NGO client state",id:"multiplay-ngo-event",level:3},{value:"Support non-default NetworkTransport provided by NGO",id:"int-ngo-nt",level:3},{value:"Multiplayer by P2P(Host/Client)",id:"mulitplay-ngo-p2p",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,i.MN)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"multiplay-using-netcode-for-gameobjects",children:"Multiplay using Netcode for GameObjects"}),"\n",(0,r.jsx)(n.h2,{id:"what-for",children:"What for?"}),"\n",(0,r.jsxs)(n.p,{children:["We provide a wrapper that makes ",(0,r.jsx)(n.a,{href:"https://docs-multiplayer.unity3d.com/netcode/current/about/index.html",children:"Netcode for GameObjects"})," easier to use in your application."]}),"\n",(0,r.jsx)(n.p,{children:"In Extreal, Netcode for GameObjects is called NGO, and this feature that wraps NGO is called the NGO wrapper."}),"\n",(0,r.jsx)(n.p,{children:"NGO provides server and client features in a single class called NetworkManager.\nSince using NetworkManager as-is always requires context-aware implementation and can be confusing, the NGO wrapper provides NgoServer and NgoClient as separate classes for the server and client, respectively."}),"\n",(0,r.jsx)(n.p,{children:"The goal is to make NGO introduction smooth by using the NGO wrapper in your applications."}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["The NGO wrapper makes NGO easier to use, but it does not mean that you only need to know the NGO wrapper to realize multiplayer without knowing NGO.\nThe NGO wrapper compensates for the difficulties or lack of features when using NGO as it is, but transfers the multiplayer process to NGO.\nTherefore, to use the NGO wrapper, it is assumed that you know NGO.\nIf you do not know NGO, please refer to ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/learning/intro#multiplayer",children:"Learning"})," to learn about NGO.\nThis guide assumes you know NGO."]})}),"\n",(0,r.jsx)(n.h2,{id:"specification",children:"Specification"}),"\n",(0,r.jsx)(n.p,{children:"The specifications of the NGO Wrapper are as follows."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You can use features for NGO servers/hosts."}),"\n",(0,r.jsx)(n.li,{children:"You can add processing triggered by NGO server/host state."}),"\n",(0,r.jsx)(n.li,{children:"You can use features for NGO clients."}),"\n",(0,r.jsx)(n.li,{children:"Reconnect when NGO client communication is disconnected."}),"\n",(0,r.jsx)(n.li,{children:"You can add processing triggered by NGO client state."}),"\n",(0,r.jsx)(n.li,{children:"You can support any NetworkTransport other than the default one provided by the NGO."}),"\n",(0,r.jsxs)(n.li,{children:["Multiplayer by P2P(Host/Client). (WebRtcTransport)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Native(C#) and WebGL(JavaScript) support."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"Since many of the features for NGO servers/hosts are common, only the different parts are clearly marked as host.\nPlease understand that the part described as server also applies to host."})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["The NGO wrapper supports the default transport provided by NGO (Unity Transport), so no additional action is required if you use the default transport.\nWhen using a new transport not provided by NGO, the IConnectionSetter used by NgoClient must be changed.\nSee ",(0,r.jsx)(n.a,{href:"#int-ngo-nt",children:"Supporting non-default NetworkTransport provided by NGO"})," for details."]})}),"\n",(0,r.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,r.jsx)(n.h3,{id:"ngo-wrapper",children:"NGO wrapper"}),"\n",(0,r.jsx)(n.mermaid,{chart:"classDiagram\n\n    NetworkManager <.. NgoServer\n    NetworkManager <.. NgoClient\n    NgoServer ..> NgoConfig\n    NgoClient ..> NgoConfig\n    NgoServer ..> IConnectionSetter\n    NgoClient ..> IConnectionSetter\n    IConnectionSetter <|.. UnityTransportConnectionSetter\n    DisposableBase <|-- NgoServer\n    DisposableBase <|-- NgoClient\n\n    class NetworkManager {\n        <<NGO>>\n    }\n\n    class NgoServer {\n        +OnServerStarted IObservable\n        +OnServerStopping IObservable\n        +OnClientConnected IObservable\n        +OnClientDisconnecting IObservable\n        +OnClientRemoving IObservable\n        +ConnectedClients IReadOnlyDictionary\n        +NgoServer(networkManager)\n        +AddConnectionSetter(connectionSetter) void\n        +StartHostAsync(ngoConfig, cancellationToken) void\n        +StartServerAsync(cancellationToken) void\n        +StopServerAsync() void\n        +SetConnectionApprovalCallback(connectionApprovalCallback) void\n        +RemoveClient(clientId) bool\n        +SendMessageToClients(clientIds, messageName, messageStream, networkDelivery) void\n        +SendMessageToAllClients(messageName, messageStream, networkDelivery) void\n        +RegisterMessageHandler(messageName, messageHandler) void\n        +UnregisterMessageHandler(messageName) void\n        +SetVisibilityDelegate(visibilityDelegate) void\n        +SpawnWithServerOwnership(prefab, position, rotation, parent, worldPositionStays) GameObject\n        +SpawnWithClientOwnership(ownerClientId, prefab, position, rotation, parent, worldPositionStays) GameObject\n        +SpawnAsPlayerObject(ownerClientId, prefab, position, rotation, parent, worldPositionStays) GameObject\n    }\n\n    class NgoClient {\n        +OnConnected IObservable\n        +OnDisconnecting IObservable\n        +OnUnexpectedDisconnected IObservable\n        +OnConnectionApprovalRejected IObservable\n        +OnConnectRetrying IObservable\n        +OnConnectRetried IObservable\n        +NgoClient(networkManager, connectRetryStrategy)\n        +AddConnectionSetter(connectionSetter) void\n        +ConnectAsync(ngoConfig, cancellationToken) bool\n        +DisconnectAsync() void\n        +SendMessage(messageName, messageStream, networkDelivery) void\n        +RegisterMessageHandler(messageName, messageHandler) void\n        +UnregisterMessageHandler(messageName) void\n    }\n\n    class NgoConfig {\n        +Address string\n        +Port ushort\n        +ConnectionData byte[]\n        +Timeout TimeSpan\n        +NgoConfig(address, port, connectionData, timeout)\n    }\n\n    class IConnectionSetter {\n        <<interface>>\n        +TargetType Type\n        +Set(networkTransport, ngoConfig)\n    }\n\n    class UnityTransportConnectionSetter {\n    }\n\n    class DisposableBase {\n        <<extreal>>\n    }"}),"\n",(0,r.jsx)(n.h3,{id:"webrtctransport",children:"WebRtcTransport"}),"\n",(0,r.jsx)(n.h4,{id:"unity",children:"Unity"}),"\n",(0,r.jsx)(n.mermaid,{chart:"classDiagram\n\n    NetworkTransport <|-- WebRtcTransport\n    IConnectionSetter <|.. WebRtcTransportConnectionSetter\n    WebRtcTransportConnectionSetter ..> WebRtcTransport\n    WebRtcClientProvider ..> WebRtcClient\n    WebRtcTransport ..> WebRtcClient\n    WebRtcClient <|-- NativeWebRtcClient\n    WebRtcClient <|-- WebGLWebRtcClient\n    NativeWebRtcClient ..> NativePeerClient\n\n    class NetworkTransport {\n        <<NGO>>\n    }\n\n    class WebRtcTransport {\n    }\n\n    class IConnectionSetter {\n        <<interface>>\n    }\n    \n    class WebRtcTransportConnectionSetter {\n    }\n\n    class WebRtcClientProvider {\n        +Provide(peerClient)$ WebRtcClient\n    }\n    \n    class WebRtcClient {\n    }\n    \n    class NativeWebRtcClient {\n    }\n    \n    class WebGLWebRtcClient {\n    }\n    \n    class NativePeerClient {\n        <<extreal>>\n    }"}),"\n",(0,r.jsx)(n.h4,{id:"javascript",children:"JavaScript"}),"\n",(0,r.jsx)(n.mermaid,{chart:"classDiagram\n\n    WebGLWebRtcClient ..> WebGLHelper\n    WebGLHelper ..> WebRtcClient\n    WebRtcAdapter ..> WebRtcClient \n\n    class WebGLWebRtcClient {\n        <<C#>>\n    }\n    \n    class WebGLHelper {\n        <<C#>>\n    }\n    \n    class WebRtcAdapter {\n        <<TypeScript>>\n    }\n\n    class WebRtcClient {\n        <<TypeScript>>\n    }"}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(n.h3,{id:"package",children:"Package"}),"\n",(0,r.jsx)(n.h4,{id:"unity-1",children:"Unity"}),"\n",(0,r.jsx)(n.p,{children:"Using the NGO Wrapper"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"https://github.com/extreal-dev/Extreal.Integration.Multiplay.NGO.git\n"})}),"\n",(0,r.jsx)(n.p,{children:"Using WebRtcTransport"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"https://github.com/extreal-dev/Extreal.Integration.Multiplay.NGO.WebRTC.git\n"})}),"\n",(0,r.jsx)(n.h4,{id:"npm",children:"npm"}),"\n",(0,r.jsx)(n.p,{children:"Using WebRtcTransport"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"@extreal-dev/extreal.integration.multiplay.ngo.webrtc\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"Using the NGO Wrapper"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/core/logging",children:"Extreal.Core.Logging"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/core/common",children:"Extreal.Core.Common"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs-multiplayer.unity3d.com/netcode/current/about/index.html",children:"Netcode for GameObjects"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/Cysharp/UniTask",children:"UniTask"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/neuecc/UniRx",children:"UniRx"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Using WebRtcTransport"}),"\n",(0,r.jsx)(n.h4,{id:"unity-2",children:"Unity"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/web.common",children:"Extreal.Integration.Web.Common"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/p2p.webrtc",children:"Extreal.Integration.P2P.WebRTC"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.unity3d.com/Packages/com.unity.webrtc@3.0/manual/index.html",children:"WebRTC"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"npm-1",children:"npm"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@extreal-dev/extreal.integration.web.common",children:"@extreal-dev/extreal.integration.web.common"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.npmjs.com/package/@extreal-dev/extreal.integration.p2p.webrtc",children:"@extreal-dev/extreal.integration.p2p.webrtc"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Please refer to ",(0,r.jsx)(n.a,{href:"../category/release",children:"Release"})," for the correspondence between module version and each package version."]}),"\n",(0,r.jsx)(n.h3,{id:"settings",children:"Settings"}),"\n",(0,r.jsx)(n.h4,{id:"ngo-wrapper-1",children:"NGO wrapper"}),"\n",(0,r.jsx)(n.p,{children:"NgoServer and NgoClient are initialized.\nInitializing NgoServer and NgoClient requires NetworkManager.\nThe NetworkManager is set to NgoServer and NgoClient using VContainer."}),"\n",(0,r.jsx)(n.p,{children:"The NGO NetworkManager is assumed to be initialized by attaching it to a GameObject."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class MultiplayServerScope : LifetimeScope\n{\n    [SerializeField] private NetworkManager networkManager;\n\n    protected override void Configure(IContainerBuilder builder)\n    {\n        builder.RegisterComponent(networkManager);\n        builder.Register<NgoServer>(Lifetime.Singleton);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class MultiplayControlScope : LifetimeScope\n{\n    [SerializeField] private NetworkManager networkManager;\n\n    protected override void Configure(IContainerBuilder builder)\n    {\n        builder.RegisterComponent(networkManager);\n        builder.Register<NgoClient>(Lifetime.Singleton)\n            .WithParameter(typeof(IRetryStrategy), NoRetryStrategy.Instance);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"NetworkManager needs to be configured the same on server and client, so it should be Prefab and use the same on server and client."})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["If you want to use a new transport not provided by NGO, please refer to ",(0,r.jsx)(n.a,{href:"#int-ngo-nt",children:"Supporting non-default NetworkTransport provided by NGO"}),".\nIf you use the default transport provided by the NGO (Unity Transport), no work is required."]})}),"\n",(0,r.jsx)(n.h4,{id:"mulitplay-ngo-settings-webrtctransport",children:"WebRtcTransport"}),"\n",(0,r.jsxs)(n.p,{children:["WebRtcTransport uses ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/p2p.webrtc",children:"P2P.WebRTC"})," to realize P2P.\n",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/p2p.webrtc#settings",children:"WebRTC Settings"})," is required.\nAdd the following initialization after setting up P2P.WebRTC."]}),"\n",(0,r.jsx)(n.p,{children:"If using WebRtcTransport, first configure WebRtcTransport in the NetworkManager inspector.\nNext, initialize NgoServer and NgoClient so that WebRtcClient can be configured for WebRtcTransport.\nSet WebRtcClient to WebRtcTransport via WebRtcTransportConnectionSetter."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public class ClientControlScope : LifetimeScope\n{\n    [SerializeField] private NetworkManager networkManager;\n\n    protected override void Configure(IContainerBuilder builder)\n    {\n        var peerConfig = new PeerConfig("http://127.0.0.1:3010");\n        var peerClient = PeerClientProvider.Provide(peerConfig);\n        builder.RegisterComponent(peerClient);\n\n        var webRtcClient = WebRtcClientProvider.Provide(peerClient);\n        var webRtcTransportConnectionSetter = new WebRtcTransportConnectionSetter(webRtcClient);\n\n        var ngoHost = new NgoServer(networkManager);\n        ngoHost.AddConnectionSetter(webRtcTransportConnectionSetter);\n        builder.RegisterComponent(ngoHost);\n\n        var ngoClient = new NgoClient(networkManager, assetHelper.NgoClientConfig.RetryStrategy);\n        ngoClient.AddConnectionSetter(webRtcTransportConnectionSetter);\n        builder.RegisterComponent(ngoClient);\n\n        builder.RegisterEntryPoint<ClientControlPresenter>();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"If used with WebGL, further JavaScript initialization is required.\nCreate a WebRtcAdapter and call the adapt function."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { PeerAdapter } from "@extreal-dev/extreal.integration.p2p.webrtc";\nimport { WebRtcAdapter } from "@extreal-dev/extreal.integration.multiplay.ngo.webrtc";\n\nconst peerAdapter = new PeerAdapter();\npeerAdapter.adapt();\n\nconst webRtcAdapter = new WebRtcAdapter();\nwebRtcAdapter.adapt(peerAdapter.getPeerClient);\n'})}),"\n",(0,r.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.h3,{id:"mulitplay-ngo-server-host",children:"Use features for NGO servers/hosts"}),"\n",(0,r.jsx)(n.p,{children:"Features for NGO servers/hosts are provided by NgoServer.\nHere are some basic instructions on how to use NgoServer.\nSince NgoServer transfers the multiplayer processing to NetworkManager, please refer to the NGO documentation for details on each feature."}),"\n",(0,r.jsx)(n.p,{children:"The server is started using StartServerAsync."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoServer.StartServerAsync().Forget();\n"})}),"\n",(0,r.jsx)(n.p,{children:"The host is started using StartHostAsync."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoServer.StartHostAsync(ngoConfig).Forget();\n"})}),"\n",(0,r.jsx)(n.p,{children:"The server is stopped by StopServerAsync, but StopServerAsync is called in NgoServer's Dispose.\nWhen the application is terminated, NgoServer's Dispose should be called."}),"\n",(0,r.jsx)(n.p,{children:"Processing in response to messages from clients is registered with RegisterMessageHandler.\nUnregistration is done with UnregisterMessageHandler.\nThe following code registers and unregisters at the start and end of the server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoServer.OnServerStarted.Subscribe(_ =>\n{\n    ngoServer.RegisterMessageHandler(MessageName.PlayerSpawn.ToString(), PlayerSpawnMessageHandler);\n}).AddTo(compositeDisposable);\n\nngoServer.OnServerStopping.Subscribe(_ =>\n{\n    ngoServer.UnregisterMessageHandler(MessageName.PlayerSpawn.ToString());\n}).AddTo(compositeDisposable);\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can use SpawnAsPlayerObject if you want to spawn a player at an arbitrary time or if you want to dynamically switch the player's prefab.\nThe following code is a response to a message from the client registered with RegisterMessageHandler above.\nThe player is spawned in response to a message from the client."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'private async void PlayerSpawnMessageHandler(ulong clientId, FastBufferReader messageStream)\n{\n    if (Logger.IsDebug())\n    {\n        Logger.LogDebug($"{MessageName.PlayerSpawn}: {clientId}");\n    }\n    messageStream.ReadValueSafe(out string avatarAssetName);\n    var result = Addressables.LoadAssetAsync<GameObject>(avatarAssetName);\n    var playerPrefab = await result.Task;\n    ngoServer.SpawnAsPlayerObject(clientId, playerPrefab);\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"add-a-processing-triggered-by-ngo-serverhost-state",children:"Add a processing triggered by NGO server/host state"}),"\n",(0,r.jsx)(n.p,{children:"NgoServer has the following event notifications."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OnServerStarted","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately after the server starts"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnServerStopping","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Just before the server stops"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnClientConnected","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately after a client connects"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: Connected client ID"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnClientDisconnecting","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Just before a client disconnects"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: Client ID to be disconnected"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnClientRemoving","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately before the client is removed"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: Client ID to be removed"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following is an example of adding processing at server startup and shutdown"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoServer.OnServerStarted.Subscribe(_ =>\n{\n    ngoServer.RegisterMessageHandler(MessageName.PlayerSpawn.ToString(), PlayerSpawnMessageHandler);\n}).AddTo(compositeDisposable);\n\nngoServer.OnServerStopping.Subscribe(_ =>\n{\n    ngoServer.UnregisterMessageHandler(MessageName.PlayerSpawn.ToString());\n}).AddTo(compositeDisposable);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"use-features-for-ngo-clients",children:"Use features for NGO clients"}),"\n",(0,r.jsx)(n.p,{children:"NGO client features are provided by NgoClient.\nHere are some basic instructions on how to use NgoClient.\nNgoClient transfers the multiplayer processing to NetworkManager, so please refer to the NGO documentation for details on each feature."}),"\n",(0,r.jsx)(n.p,{children:"ConnectAsync is used to connect to the server.\nConnection information is specified in NgoConfig.\nSince it is assumed that an instance of NgoClient is reused while the application is running, the connection information is specified each time the connection is made."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"var ngoConfig = new NgoConfig();\nngoClient.ConnectAsync(ngoConfig).Forget();\n"})}),"\n",(0,r.jsx)(n.p,{children:"The default for NgoConfig is as follows.\nIf timeout is null, it is set to 10 seconds.\nTimeoutException is thrown when the timeout period elapses in the connection process."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:'public NgoConfig\n(\n    string address = "127.0.0.1",\n    ushort port = 7777,\n    byte[] connectionData = null,\n    TimeSpan timeout = null\n)\n'})}),"\n",(0,r.jsx)(n.p,{children:"DisconnectAsync is used to disconnect from the server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoClient.DisconnectAsync().Forget();\n"})}),"\n",(0,r.jsx)(n.p,{children:"SendMessage is used to send messages to the server.\nThe following code sends a message to the server to spawn a player after connecting to the server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoClient.OnConnected.Subscribe(_ =>\n{\n    var messageStream = new FastBufferWriter(FixedString64Bytes.UTF8MaxLengthInBytes, Allocator.Temp);\n    ngoClient.SendMessage(MessageName.PlayerSpawn.ToString(), messageStream);\n}).AddTo(compositeDisposable);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"multiplay-ngo-retry",children:"Reconnect when NGO client communication is disconnected"}),"\n",(0,r.jsxs)(n.p,{children:["NgoClient uses the retry processing provided by ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/core/common",children:"Common"})," to reconnect when communication is disconnected.\nThe following description assumes that you are familiar with the retry processing, so if you have not checked the retry processing, please check the ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/core/common#core-common-retry",children:"retry processing"})," first."]}),"\n",(0,r.jsx)(n.p,{children:"NgoClient does not reconnect by default.\nIf a retry strategy is specified when NgoClient is initialized, it will reconnect."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"builder.Register<NgoClient>(Lifetime.Singleton).WithParameter(typeof(IRetryStrategy), new CountingRetryStrategy());\n"})}),"\n",(0,r.jsx)(n.p,{children:"The reconnection processing handled by NgoClient is as follows."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When to run reconnection","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If a connection failed"}),"\n",(0,r.jsx)(n.li,{children:"Unexpected disconnection from the server"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Reconnection processing details","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["If a connection failed","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Repeat the connection according to the retry strategy."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Unexpected disconnection from the server","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Repeat the connection according to the retry strategy."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.a,{href:"#multiplay-ngo-event",children:"event notifications"})," if you want to run processing based on the status of retry processing."]}),"\n",(0,r.jsx)(n.h3,{id:"multiplay-ngo-event",children:"Add a processing triggered by NGO client state"}),"\n",(0,r.jsx)(n.p,{children:"NgoClient has the following event notifications."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["OnConnected","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately after connecting to the server"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnDisconnecting","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Just before disconnecting from the server"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnUnexpectedDisconnected","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately after an unexpected server disconnection occurs"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnConnectionApprovalRejected","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing: Immediately after a connection approval is rejected"}),"\n",(0,r.jsx)(n.li,{children:"Type: IObservable"}),"\n",(0,r.jsx)(n.li,{children:"Parameters: None"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnConnectRetrying","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timing\uff1aJust before retrying the connection"}),"\n",(0,r.jsx)(n.li,{children:"Type\uff1aIObservable"}),"\n",(0,r.jsxs)(n.li,{children:["Parameters\uff1aRetry count","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The first time is ",(0,r.jsx)(n.code,{children:"1"})," and the second time is ",(0,r.jsx)(n.code,{children:"2"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"1"})," means the start of retry strategy running."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["OnConnectRetried","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Timing\uff1aImmediately after connection retry is finished","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"If the retry is canceled, it will not be notified."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Type\uff1aIObservable"}),"\n",(0,r.jsxs)(n.li,{children:["Parameters\uff1aRetry result","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"true: If the retry strategy is run and the retry is successful"}),"\n",(0,r.jsx)(n.li,{children:"false: If the retry strategy is run and the retry is not successful finally"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The following is an example of adding processing immediately after connecting to the server."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoClient.OnConnected.Subscribe(_ =>\n{\n    var messageStream = new FastBufferWriter(FixedString64Bytes.UTF8MaxLengthInBytes, Allocator.Temp);\n    ngoClient.SendMessage(MessageName.PlayerSpawn.ToString(), messageStream);\n}).AddTo(compositeDisposable);\n"})}),"\n",(0,r.jsx)(n.h3,{id:"int-ngo-nt",children:"Support non-default NetworkTransport provided by NGO"}),"\n",(0,r.jsx)(n.p,{children:"NGO can change the transport used for communication.\nThe NGO wrapper supports the default transport provided by NGO (Unity Transport), so if you use the default transport, no additional action is required.\nIf you want to use a new transport that is not provided by NGO, you will need to change the IConnectionSetter used by NgoClient."}),"\n",(0,r.jsx)(n.p,{children:"Since the part of each transport implementation that holds connection information is not standardized, it is necessary to absorb the differences.\nIConnectionSetter is provided to fill in the implementation differences of each transport."}),"\n",(0,r.jsx)(n.p,{children:"To use a new transport, it is necessary to create a class that implements the IConnectionSetter and set it in NgoClient.\nThe implementation of IConnectionSetter for UnityTransport is shown below for reference when implementing IConnectionSetter."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"public class UnityTransportConnectionSetter : IConnectionSetter\n{\n    public Type TargetType => typeof(UnityTransport);\n\n    public void Set(NetworkTransport networkTransport, NgoConfig ngoConfig)\n    {\n        var unityTransport = networkTransport as UnityTransport;\n        unityTransport.ConnectionData.Address = ngoConfig.Address.Trim();\n        unityTransport.ConnectionData.Port = ngoConfig.Port;\n        unityTransport.ConnectionData.ServerListenAddress = ngoConfig.Address.Trim();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Set the implemented class with NgoClient's AddConnectionSetter."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"ngoClient.AddConnectionSetter(new UnityTransportConnectionSetter());\n"})}),"\n",(0,r.jsx)(n.h3,{id:"mulitplay-ngo-p2p",children:"Multiplayer by P2P(Host/Client)"}),"\n",(0,r.jsxs)(n.p,{children:["The WebRtcTransport setting allows for P2P multiplayer.\nTo set it up, go to ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/multiplay.ngo#multitplay-ngo-settings-webrtctransport",children:"Settings"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["WebRtcTransport uses ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/p2p.webrtc",children:"P2P.WebRTC"})," to realize P2P.\nUse ",(0,r.jsx)(n.a,{href:"/Extreal.Guide/en/next/integration/p2p.webrtc#p2p-webrtc-host-client",children:"P2P.WebRTC's API"})," to establish the host/client connection."]}),"\n",(0,r.jsx)(n.p,{children:"Since the NGO connection must be initiated after the P2P connection is established, the start timing of NgoServer and NgoClient is determined by the OnStarted event of PeerClient."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",children:"peerClient.OnStarted\n    .Subscribe(_ => ngoServer.StartHostAsync(ngoConfig).Forget())\n    .AddTo(disposables);\n\npeerClient.OnStarted\n    .Subscribe(_ => ngoClient.ConnectAsync(ngoConfig).Forget())\n    .AddTo(disposables);\n"})})]})}function p(e={}){const{wrapper:n}={...(0,i.MN)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},5788:(e,n,t)=>{t.d(n,{MN:()=>c});var r=t(1504);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},d={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,s=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),h=c(t),g=i,u=h["".concat(l,".").concat(g)]||h[g]||d[g]||s;return t?r.createElement(u,a(a({ref:n},p),{},{components:t})):r.createElement(u,a({ref:n},p))}));p.displayName="MDXCreateElement"}}]);