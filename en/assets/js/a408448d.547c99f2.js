"use strict";(self.webpackChunkextreal=self.webpackChunkextreal||[]).push([[7442],{7377:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>g,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var n=a(7462),i=(a(7294),a(3905)),o=a(1839);const s={sidebar_position:2},l="Stage Navigation",r={unversionedId:"core/stage-navigation",id:"version-1.0.0/core/stage-navigation",title:"Stage Navigation",description:"What for?",source:"@site/i18n/en/docusaurus-plugin-content-docs/version-1.0.0/core/stage-navigation.md",sourceDirName:"core",slug:"/core/stage-navigation",permalink:"/Extreal.Guide/en/1.0.0/core/stage-navigation",draft:!1,tags:[],version:"1.0.0",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Logging",permalink:"/Extreal.Guide/en/1.0.0/core/logging"},next:{title:"Integration",permalink:"/Extreal.Guide/en/1.0.0/category/integration"}},g={},c=[{value:"What for?",id:"what-for",level:2},{value:"Specification",id:"specification",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Installation",id:"installation",level:2},{value:"Package",id:"package",level:3},{value:"Dependencies",id:"dependencies",level:3},{value:"Settings",id:"settings",level:3},{value:"Usage",id:"usage",level:2},{value:"Transition to the specified stage",id:"transition-to-the-specified-stage",level:3},{value:"Add processing to trigger stage transitions",id:"core-sn-event",level:3}],p={toc:c};function u(e){let{components:t,...s}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"stage-navigation"},"Stage Navigation"),(0,i.kt)("h2",{id:"what-for"},"What for?"),(0,i.kt)("p",null,"Stage Navigation is provided to easily create stages that combine multiple scenes and switch between stages as described in ",(0,i.kt)("a",{parentName:"p",href:"/Extreal.Guide/en/1.0.0/intro#application"},"the application architecture assumed by Framework"),"."),(0,i.kt)("p",null,"The diagram shown in ",(0,i.kt)("a",{parentName:"p",href:"/Extreal.Guide/en/1.0.0/intro#application"},"the application architecture assumed by Framework")," is reproduced below.\n",(0,i.kt)("img",{alt:"Multiple scenes",src:a(3394).Z,width:"1224",height:"436"})),(0,i.kt)("p",null,"If you are able to create stages in your application using Stage Navigation and freely combining features, you will have an application that is easier to maintain and more reusable."),(0,i.kt)("h2",{id:"specification"},"Specification"),(0,i.kt)("p",null,"Stage Navigation specifications are as follows."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Stages can be set by combining multiple scenes."),(0,i.kt)("li",{parentName:"ul"},"Scenes common to all stages can be set together in one place."),(0,i.kt)("li",{parentName:"ul"},"You can transition to a specified stage."),(0,i.kt)("li",{parentName:"ul"},"Processing can be added to trigger stage transitions.")),(0,i.kt)("h2",{id:"architecture"},"Architecture"),(0,i.kt)(o.G,{chart:"classDiagram\n\n    StageNavigator ..> IStageConfig\n    IStageConfig <|.. StageConfigBase\n    StageConfigBase <|-- StageConfig\n    ScriptableObject <|-- StageConfigBase\n    IStageConfig *-- Stage : Stages\n    IStageConfig o-- SceneName : CommonStages\n    Stage --\x3e StageName : StageName\n    Stage o-- SceneName : SceneNames\n    IDisposable\u3000<|.. StageNavigator\n\n    class StageName {\n        <<enumeration>>\n    }\n\n    class SceneName {\n        <<enumeration>>\n    }\n\n    class StageConfig {\n    }\n\n    class StageNavigator {\n        +OnStageTransitioning IObservable\n        +OnStageTransitioned IObservable\n        +StageNavigator(stageConfig)\n        +ReplaceAsync(stageName) void\n    }\n\n    class IStageConfig {\n        +CommonScenes List\n        +Stages List\n    }\n\n    class StageConfigBase {\n        \n    }\n\n    class ScriptableObject {\n        <<unity>>\n    }\n\n    class Stage {\n        +StageName Enum\n        +SceneNames List\n    }\n\n    class IDisposable {\n        <<system>>\n    }",mdxType:"Mermaid"}),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The following types are created in the application"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"StageName: Enum representing the stage name"),(0,i.kt)("li",{parentName:"ul"},"SceneName: Enum representing the scene name"),(0,i.kt)("li",{parentName:"ul"},"StageConfig: Class that holds the stage configuration"))),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("h3",{id:"package"},"Package"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"https://github.com/extreal-dev/Extreal.Core.StageNavigation.git\n")),(0,i.kt)("h3",{id:"dependencies"},"Dependencies"),(0,i.kt)("p",null,"Stage Navigation uses the following packages."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"/Extreal.Guide/en/1.0.0/core/logging"},"Extreal.Core.Logging")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/Cysharp/UniTask"},"UniTask")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/neuecc/UniRx"},"UniRx"))),(0,i.kt)("p",null,"Please refer to ",(0,i.kt)("a",{parentName:"p",href:"../category/release"},"Release")," for the correspondence between module version and each package version."),(0,i.kt)("h3",{id:"settings"},"Settings"),(0,i.kt)("p",null,"The stages to be used in the application are set up.\nYou create the following three types."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Enum representing the stage name"),(0,i.kt)("li",{parentName:"ul"},"Enum that represents the scene name"),(0,i.kt)("li",{parentName:"ul"},"Class that holds the stage settings")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"// Enum for the stage name\npublic enum StageName\n{\n    TitleStage = 0,\n    AvatarSelectionStage = 1,\n    SpaceSelectionStage = 2,\n    VirtualStage = 3,\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"// Enum for the scene name\npublic enum SceneName\n{\n    // Control\n    CameraControl = 100,\n    InputControl = 101,\n    NetworkControl = 102,\n    PlayerControl = 103,\n    LobbyControl = 104,\n    TextChatControl = 105,\n    VoiceChatControl = 106,\n    ReactionControl = 107,\n    \n    // Screen\n    TitleScreen = 200,\n    AvatarSelectionScreen = 201,\n    SpaceSelectionScreen = 202,\n\n    // Space\n    VirtualSpace = 300,\n}\n")),(0,i.kt)("p",null,"Constant values, like stage configuration, can be specified in the Unity editor's inspector for easier editing.\nEnums for stage and scene names should be constant values because of the following problem when using Enums in the inspector"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The C# specification automatically assigns constant values to Enums in the order in which they are defined, from the top.\nIf you specify an Enum in the Inspector of the Unity Editor, the state is saved as a constant value, so if the definition order changes when the Enum is changed, the Inspector setting value will also unintentionally change.\nTo deal with this problem, specify a constant value for the Enum used in the inspector.\nThe constant value has no meaning other than identification, so any number can be used as long as it does not duplicate in each Enum.")),(0,i.kt)("p",null,"The IStageConfig interface holds the stage configuration.\nA Base class inheriting from ScriptableObject is provided so that the stage configuration can be edited in the inspector of the Unity editor.\nThe class that holds the stage configuration should inherit from the StageConfigBase class."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},'// Class that holds the stage config\n[CreateAssetMenu(\n    menuName = "Config/" + nameof(StageConfig),\n    fileName = nameof(StageConfig))]\npublic class StageConfig : StageConfigBase<StageName, SceneName>\n{\n}\n')),(0,i.kt)("p",null,"The stage configuration is set up in the Unity editor inspector.\nAn example configuration is as follows."),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Stage config",src:a(9175).Z,width:"310",height:"518"})),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"CommonScenes property",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Specifies scenes common to all stages."))),(0,i.kt)("li",{parentName:"ul"},"Stages property",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Specifies the scene configuration for each stage.")))),(0,i.kt)("p",null,"VContainer is used to initialize StageNavigator and StageConfig."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"    public class AppScope : LifetimeScope\n    {\n        [SerializeField] private StageConfig stageConfig;\n\n        protected override void Configure(IContainerBuilder builder)\n        {\n            builder.RegisterComponent(stageConfig).AsImplementedInterfaces();\n            builder.Register<StageNavigator<StageName, SceneName>>(Lifetime.Singleton);\n        }\n    }\n")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("h3",{id:"transition-to-the-specified-stage"},"Transition to the specified stage"),(0,i.kt)("p",null,"It transitions to the specified stage using StageNavigator's ReplaceAsync."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"// Transition to the title stage\nstageNavigator.ReplaceAsync(StageName.TitleStage);\n\n// Transition to the avatar selection stage\nstageNavigator.ReplaceAsync(StageName.AvatarSelectionStage);\n\n// Transition to the space selection stage\nstageNavigator.ReplaceAsync(StageName.SpaceSelectionStage);\n")),(0,i.kt)("p",null,"If a stage transition continues with the same scene, StageNavigator will reuse the scene without reloading it to reduce processing time."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"TitleStage\n  PlayerControl -> Loaded\n  TitleScreen -> Loaded\n\nAvatarSelectionStage\n  PlayerControl -> Not loading\n  AvatarSelectionScreen -> Loaded\n\nSpaceSelectionStage\n  PlayerControl -> Not loading\n  AvatarSelectionScreen -> Loaded\n")),(0,i.kt)("p",null,"Awake and Start of GameObjects in reused scenes are executed only at the time they are loaded, not at the time they are reused.\nIf you want to execute processing at the timing of stage transitions, use ",(0,i.kt)("a",{parentName:"p",href:"#core-sn-event"},"event notification")," published by StageNavigator."),(0,i.kt)("h3",{id:"core-sn-event"},"Add processing to trigger stage transitions"),(0,i.kt)("p",null,"StageNavigator has the following event notifications."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"OnStageTransitioning",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Timing: Just before the stage transition"),(0,i.kt)("li",{parentName:"ul"},"Type: IObservable"),(0,i.kt)("li",{parentName:"ul"},"Parameters: Name of the stage to be transitioned"))),(0,i.kt)("li",{parentName:"ul"},"OnStageTransitioned",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Timing: Immediately after the stage transition"),(0,i.kt)("li",{parentName:"ul"},"Type: IObservable"),(0,i.kt)("li",{parentName:"ul"},"Parameter: Name of the stage that has transitioned")))),(0,i.kt)("p",null,"The following is an example of log output at the timing of OnStageTransitioned."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csharp"},"stageNavigator.OnStageTransitioned.Subscribe(stageName =>\n{\n    Logger.LogInfo(stageName);\n}).AddTo(compositeDisposable);\n")))}u.isMDXComponent=!0},9175:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/core-stagenavigation-stageconfig-e62946ef54611fe8609ff5226857756e.png"},3394:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/multi-scenes-2e2fcb7ef0e01e1f07c78920a84ecb84.png"}}]);