<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-core/common" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Common | Extreal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://extreal-dev.github.io/Extreal.Guide/en/next/core/common"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Common | Extreal"><meta data-rh="true" name="description" content="What for?"><meta data-rh="true" property="og:description" content="What for?"><link data-rh="true" rel="icon" href="/Extreal.Guide/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://extreal-dev.github.io/Extreal.Guide/en/next/core/common"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/next/core/common" hreflang="ja"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/en/next/core/common" hreflang="en"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/next/core/common" hreflang="x-default"><script src="https://plausible.io/js/script.js" defer="defer" data-domain="extreal-dev.github.io,all.fintan"></script>
<script src="/Extreal.Guide/js/custom.js"></script>
<script src="/Extreal.Guide/en/js/custom.js"></script><link rel="stylesheet" href="/Extreal.Guide/en/assets/css/styles.bb6e314e.css">
<script src="/Extreal.Guide/en/assets/js/runtime~main.67bdbb91.js" defer="defer"></script>
<script src="/Extreal.Guide/en/assets/js/main.204b57dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://fintan.jp" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/Extreal.Guide/en/img/fintan-logo.jpg" alt="Fintan" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Extreal.Guide/en/img/fintan-logo.jpg" alt="Fintan" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Extreal.Guide/en/">Extreal</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Extreal.Guide/en/next/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/Extreal.Guide/en/next/intro">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Extreal.Guide/en/next/core/common">Next</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/core/common">1.2.0</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/1.1.0/core/common">1.1.0</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/1.0.0/intro">1.0.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/Extreal.Guide/next/core/common" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li><li><a href="/Extreal.Guide/en/next/core/common" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://fintan.jp/blog-category/xr/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Fintan - XR<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/extreal-dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Extreal.Guide/en/next/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/release">Release</a><button aria-label="Expand sidebar category &#x27;Release&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/Extreal.Guide/en/next/category/core">Core</a><button aria-label="Collapse sidebar category &#x27;Core&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Extreal.Guide/en/next/core/logging">Logging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Extreal.Guide/en/next/core/stage-navigation">Stage Navigation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Extreal.Guide/en/next/core/common">Common</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/integration">Integration</a><button aria-label="Expand sidebar category &#x27;Integration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/sample-application">Sample Application</a><button aria-label="Expand sidebar category &#x27;Sample Application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/learning">Learning</a><button aria-label="Expand sidebar category &#x27;Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/legal">Legal</a><button aria-label="Expand sidebar category &#x27;Legal&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Extreal<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/Extreal.Guide/en/core/common">latest version</a></b> (<!-- -->1.2.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Extreal.Guide/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Extreal.Guide/en/next/category/core"><span itemprop="name">Core</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Common</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="common">Common</h1>
<h2 id="what-for">What for?</h2>
<p>A generic feature like retry processing is needed to realize the features of a framework or application.
For example, retry processing is required for external connection features such as <a href="/Extreal.Guide/en/next/integration/chat.vivox">Chat</a> and <a href="/Extreal.Guide/en/next/integration/multiplay.ngo">Multiplay</a> in frameworks and external API calls in applications.
This module provides such generic processing as common features.</p>
<h2 id="specification">Specification</h2>
<ul>
<li>You can apply the <a href="https://learn.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-dispose">Dispose Pattern</a>.</li>
<li>You can apply a retry processing.</li>
<li>You can add hooks to IObservable.</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="system">System</h3>
<mermaid chart="classDiagram

    IDisposable &lt;|.. DisposableBase
    SafeDisposer &lt;.. DisposableBase
    
    class SafeDisposer {
        +SafeDisposer(target, releaseManagedResources, releaseUnmanagedResources)
        +DisposeByFinalizer()
        +Dispose()
    }

    class DisposableBase {
        #DisposableBase()
        #ReleaseManagedResources()
        #ReleaseUnmanagedResources()
    }

    class IDisposable {
        &lt;&lt;interface&gt;&gt;
    }"></mermaid>
<h3 id="retry">Retry</h3>
<mermaid chart="classDiagram

    DisposableBase &lt;|-- RetryHandler
    IRetryStrategy &lt;.. RetryHandler
    IRetryStrategy &lt;|.. CountingRetryStrategy
    IRetryStrategy &lt;|.. NoRetryStrategy

    class DisposableBase {
    }

    class RetryHandler {
        +OnRetrying IObservable
        +OnRetried IObservable
        +Of(action, isRetryable, retryStrategy, cancellationToken)$ RetryHandler
        +Of(actionAsync, isRetryable, retryStrategy, cancellationToken)$ RetryHandler
        +Of(func, isRetryable, retryStrategy, cancellationToken)$ RetryHandler
        +Of(funcAsync, isRetryable, retryStrategy, cancellationToken)$ RetryHandler
        +HandleAsync() TResult
    }
    
    class IRetryStrategy {
        &lt;&lt;interface&gt;&gt;
        +Reset() void
        +HasNext() bool
        +Next() TimeSpan
    }
    
    class CountingRetryStrategy {
        +CountingRetryStrategy(maxRetryCount, nextRetryInterval)
    }
    
    class NoRetryStrategy {
        +Instance NoRetryStrategy
    }"></mermaid>
<h3 id="hook">Hook</h3>
<mermaid chart="classDiagram

    class ObservableExtensions {
        Hook(this IObservable source, Action hook)$ IDisposable 
    }"></mermaid>
<h2 id="installation">Installation</h2>
<h3 id="package">Package</h3>
<pre><code class="language-text">https://github.com/extreal-dev/Extreal.Core.Common.git
</code></pre>
<h3 id="dependencies">Dependencies</h3>
<p>Common uses the following packages.</p>
<ul>
<li><a href="/Extreal.Guide/en/next/core/logging">Extreal.Core.Logging</a></li>
<li><a href="https://github.com/Cysharp/UniTask">UniTask</a></li>
<li><a href="https://github.com/neuecc/UniRx">UniRx</a></li>
</ul>
<p>Please refer to <a href="../category/release">Release</a> for the correspondence between module version and each package version.</p>
<h3 id="settings">Settings</h3>
<p>No work is required as there are no settings.</p>
<h2 id="usage">Usage</h2>
<h3 id="core-common-dp">Apply the Dispose Pattern</h3>
<p>We provide two ways to apply the <a href="https://learn.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-dispose">Dispose Pattern</a>: inheritance and delegation.
Use inheritance if it is available, since inheritance covers a wider range of the Dispose Pattern.
If the class to which the pattern is applied has already inherited from another class and inheritance is not available, use delegation.</p>
<p>The DisposableBase class is used in the inheritance.</p>
<pre><code class="language-csharp">public class SomethingClass : DisposableBase
{
    // Processing something with resources
    
    protected override void ReleaseManagedResources()
    {
        // release managed resources
    }

    protected override void ReleaseUnmanagedResources()
    {
        // release unmanaged resources
    }
}
</code></pre>
<p>Override the ReleaseManagedResources and ReleaseUnmanagedResources methods to release resources, depending on the resources to be handled.
By default, these methods do nothing, so there is no need to override methods that do not require release processing.
These methods are called by the DisposableBase class at the timing indicated in the Dispose Pattern.</p>
<admonition type="caution"><p>To prevent resource release omissions, implement the resource release processing in such a way that it does not raise exceptions or errors.</p></admonition>
<admonition type="caution"><p>The <a href="https://learn.microsoft.com/en-us/dotnet/standard/garbage-collection/implementing-dispose">Dispose Pattern</a> shows the correct way to implement Dispose.
Even if you follow the Dispose Pattern, your application must call IDisposable&#x27;s Dispose method at the appropriate time.
The same is true when using DisposableBase.</p></admonition>
<p>The SafeDisposer class is used in the delegation.
The DisposableBase class uses the SafeDisposer class to realize the Dispose Pattern.
Please refer to the source code of the DisposableBase class as an example of implementation of the SafeDisposer class.</p>
<pre><code class="language-csharp">public class DisposableBase : IDisposable
{
    private readonly SafeDisposer safeDisposer;

    protected DisposableBase()
        =&gt; safeDisposer = new SafeDisposer(this, ReleaseManagedResources, ReleaseUnmanagedResources);

    ~DisposableBase() =&gt; safeDisposer.DisposeByFinalizer();

    protected virtual void ReleaseManagedResources() { }

    protected virtual void ReleaseUnmanagedResources() { }

    public void Dispose() =&gt; safeDisposer.Dispose();
}
</code></pre>
<h3 id="core-common-retry">Apply a retry processing</h3>
<h4 id="retry-processing">Retry processing</h4>
<p>Retry processing is provided by the RetryHandler class.
The RetryHandler class can be used to apply retry processing to methods.</p>
<p>The conditions for methods to which retry processing can be applied are as follows.</p>
<ul>
<li>The target method is one of the following.<!-- -->
<ul>
<li>Synchronous processing without return value<!-- -->
<pre><code class="language-csharp">void RunAction()
</code></pre>
</li>
<li>Asynchronous processing without return value<!-- -->
<pre><code class="language-csharp">UniTask RunActionAsync()
</code></pre>
</li>
<li>Synchronous processing with return value<!-- -->
<pre><code class="language-csharp">TResult RunFunc()
</code></pre>
</li>
<li>Asynchronous processing with return value<!-- -->
<pre><code class="language-csharp">UniTask&lt;TResult&gt; RunFuncAsync()
</code></pre>
</li>
</ul>
</li>
<li>Method arguments can be provided or not.</li>
<li>Use <a href="https://github.com/Cysharp/UniTask">UniTask</a> for asynchronous processing.</li>
<li>Be able to determine whether to retry or not by looking at the exception. (Throw an exception if the processing to be retried fails)</li>
</ul>
<p>Retry processing is applied using the Of method of RetryHandler.
The Of method creates a RetryHandler so that a method with retry processing applied can be called.
The Of method accepts the following parameters.</p>
<ul>
<li>Retry target method</li>
<li>Processing to determine whether to retry or not</li>
<li>How to control retry processing (retry strategy)</li>
<li>Token for cancelling retry</li>
</ul>
<p>The HandleAsync method of RetryHandler is used to run the method to which retry processing is applied.
The HandleAsync method starts the retry processing if the method to be retried fails.
HandleAsync uses a retry or not retry decision processing and a retry strategy to determine whether or not to continue retries.</p>
<pre><code class="language-csharp">using var retryHandler = RetryHandler&lt;Unit&gt;.Of(RunAction, e =&gt; e is AccessViolationException, new CountingRetryStrategy());
await retryHandler.HandleAsync();
</code></pre>
<p>If the method to be retried has arguments, use <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/operators/lambda-expressions">lambda expression</a>.</p>
<pre><code class="language-csharp">// Synchronous processing without return value
using var retryHandler = RetryHandler&lt;Unit&gt;.Of(() =&gt; RunAction(value), e =&gt; e is AccessViolationException, new CountingRetryStrategy());
await retryHandler.HandleAsync();

// Asynchronous processing without return value
using var retryHandler = RetryHandler&lt;Unit&gt;.Of(() =&gt; RunActionAsync(value), e =&gt; e is AccessViolationException, new CountingRetryStrategy());
await retryHandler.HandleAsync();

// Synchronous processing with return value
using var retryHandler = RetryHandler&lt;Unit&gt;.Of(() =&gt; RunFunc(value), e =&gt; e is AccessViolationException, new CountingRetryStrategy());
var result = await retryHandler.HandleAsync();

// Asynchronous processing with return value
using var retryHandler = RetryHandler&lt;Unit&gt;.Of(() =&gt; RunFuncAsync(value), e =&gt; e is AccessViolationException, new CountingRetryStrategy());
var result = await retryHandler.HandleAsync();
</code></pre>
<h4 id="retry-strategy">Retry strategy</h4>
<p>The following retry strategies are provided by default.</p>
<ul>
<li>CountingRetryStrategy<!-- -->
<ul>
<li>The retry processing is controlled by the retry count.</li>
</ul>
</li>
<li>NoRetryStrategy<!-- -->
<ul>
<li>Always no retry.</li>
<li>This is used when creating a library that has built-in retry processing.</li>
</ul>
</li>
</ul>
<p>CountingRetryStrategy is used to specify the maximum retry count and retry interval.</p>
<pre><code class="language-csharp">// Max retry count is 5, retry interval is 5 seconds each times
var retryStrategy = new CountingRetryStrategy(5, _ =&gt; TimeSpan.FromSeconds(5));

// Max retry count is 5, retry interval is retry count x 5 seconds
var retryStrategy = new CountingRetryStrategy(5, retryCount =&gt; TimeSpan.FromSeconds(retryCount * 5));
</code></pre>
<p>CountingRetryStrategy provides retry processing using Fibonacci numbers by default.
The default Fibonacci number is limited to 20, so if you wish to increase the maximum retry count beyond 20, please specify the retry interval.</p>
<pre><code class="language-csharp">// Max retry count is 12(default), retry interval is Fibonacci numbers
var retryStrategy = new CountingRetryStrategy();

// Max retry count is 5, retry interval is Fibonacci numbers
var retryStrategy = new CountingRetryStrategy(5);
</code></pre>
<p>Retry strategy is provided by the IRetryStrategy interface.
If the class provided by default does not support your needs, please create a class that implements the IRetryStrategy interface.</p>
<h4 id="reuse-of-retry-processing">Reuse of retry processing</h4>
<p>Unexpected disconnections may occur during connections in voice chat and multiplayer.
When such a disconnection occurs, you may want to reconnect using the state of the initial connection (channel name and other access information).
RetryHandler resets the retry state each time the HandleAsync method is called, so it can be reused.</p>
<h4 id="core-common-retry-event">Event notifications for retry processing</h4>
<p>RetryHandler has the following event notifications.</p>
<ul>
<li>OnRetrying<!-- -->
<ul>
<li>Timing：Just before retry</li>
<li>Type：IObservable</li>
<li>Parameters：Retry count<!-- -->
<ul>
<li>The first time is <code>1</code> and the second time is <code>2</code>.</li>
<li><code>1</code> means the start of retry strategy running.</li>
</ul>
</li>
</ul>
</li>
<li>OnRetried<!-- -->
<ul>
<li>Timing：Immediately after the retry is finished<!-- -->
<ul>
<li>If the retry is canceled, it will not be notified.</li>
</ul>
</li>
<li>Type：IObservable</li>
<li>Parameters：Retry result<!-- -->
<ul>
<li>true: If the retry strategy is run and the retry is successful</li>
<li>false: If the retry strategy is run and the retry is not successful finally</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="core-common-hook">Add hooks to IObservable</h3>
<p>When using IObservable, notifications are usually received via the Subscribe method.
In some cases, such as when you want to send the application&#x27;s operation log to an external server, you may want to add processing to the IObservable without interfering with the application&#x27;s original subscription processing.
The processing you want to add to the IObservable without interfering with the application&#x27;s original processing is called a hook.</p>
<p>Hooks must handle exceptions so that the processing of the application is not interrupted in the event of a processing failure.
The Hook method to which hooks can be added is provided as an extension method of IObservable.</p>
<p>This is an example of an implementation that sends stage usage status (e.g., stay time) at the timing of stage transitions.</p>
<pre><code class="language-csharp">stageNavigator.OnStageTransitioning
              .Hook(_ =&gt; CollectStageUsage())
              .AddTo(disposables);
</code></pre>
<p>Unlike Subscribe, an exception raised by a processing executed with the Hook method does not affect other subscription processing.
To ensure that the developer is aware during development that an exception was raised by Hook, exception information is logged output with the Error level only when the log level is Debug.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Extreal.Guide/en/next/core/stage-navigation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Stage Navigation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Extreal.Guide/en/next/category/integration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Integration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-for" class="table-of-contents__link toc-highlight">What for?</a></li><li><a href="#specification" class="table-of-contents__link toc-highlight">Specification</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a><ul><li><a href="#system" class="table-of-contents__link toc-highlight">System</a></li><li><a href="#retry" class="table-of-contents__link toc-highlight">Retry</a></li><li><a href="#hook" class="table-of-contents__link toc-highlight">Hook</a></li></ul></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href="#package" class="table-of-contents__link toc-highlight">Package</a></li><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li><li><a href="#settings" class="table-of-contents__link toc-highlight">Settings</a></li></ul></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#core-common-dp" class="table-of-contents__link toc-highlight">Apply the Dispose Pattern</a></li><li><a href="#core-common-retry" class="table-of-contents__link toc-highlight">Apply a retry processing</a></li><li><a href="#core-common-hook" class="table-of-contents__link toc-highlight">Add hooks to IObservable</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">License</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apache License 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Feedback</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/extreal-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Used by</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.buralit.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">BURALIT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item">
                    <a class="footer__link-item" href="javascript:void(0);" onclick="goTermsOfUse()">Terms of Use</a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 TIS, Inc. Built with Docusaurus.<br><small>The names of products or services appearing on this site are trademarks or registered trademarks of the respective companies.</small></div></div></div></footer></div>
</body>
</html>