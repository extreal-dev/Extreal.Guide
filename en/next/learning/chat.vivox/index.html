<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-learning/chat.vivox" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Chat using Vivox | Extreal</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://extreal-dev.github.io/Extreal.Guide/en/next/learning/chat.vivox"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="ja"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Chat using Vivox | Extreal"><meta data-rh="true" name="description" content="In this section, you will learn about the Vivox wrapper."><meta data-rh="true" property="og:description" content="In this section, you will learn about the Vivox wrapper."><link data-rh="true" rel="icon" href="/Extreal.Guide/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://extreal-dev.github.io/Extreal.Guide/en/next/learning/chat.vivox"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/next/learning/chat.vivox" hreflang="ja"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/en/next/learning/chat.vivox" hreflang="en"><link data-rh="true" rel="alternate" href="https://extreal-dev.github.io/Extreal.Guide/next/learning/chat.vivox" hreflang="x-default"><script src="https://plausible.io/js/script.js" defer="defer" data-domain="extreal-dev.github.io,all.fintan"></script>
<script src="/Extreal.Guide/js/custom.js"></script>
<script src="/Extreal.Guide/en/js/custom.js"></script><link rel="stylesheet" href="/Extreal.Guide/en/assets/css/styles.bb6e314e.css">
<script src="/Extreal.Guide/en/assets/js/runtime~main.ec92d0c9.js" defer="defer"></script>
<script src="/Extreal.Guide/en/assets/js/main.204b57dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://fintan.jp" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/Extreal.Guide/en/img/fintan-logo.jpg" alt="Fintan" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/Extreal.Guide/en/img/fintan-logo.jpg" alt="Fintan" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/Extreal.Guide/en/">Extreal</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Extreal.Guide/en/next/intro">Docs</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/Extreal.Guide/en/next/intro">Next</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/Extreal.Guide/en/next/learning/chat.vivox">Next</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/learning/chat.vivox">1.2.0</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/1.1.0/learning/chat.vivox">1.1.0</a></li><li><a class="dropdown__link" href="/Extreal.Guide/en/1.0.0/learning/chat.vivox">1.0.0</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/Extreal.Guide/next/learning/chat.vivox" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="ja">日本語</a></li><li><a href="/Extreal.Guide/en/next/learning/chat.vivox" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://fintan.jp/blog-category/xr/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Fintan - XR<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/extreal-dev" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/Extreal.Guide/en/next/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/release">Release</a><button aria-label="Expand sidebar category &#x27;Release&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/core">Core</a><button aria-label="Expand sidebar category &#x27;Core&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/integration">Integration</a><button aria-label="Expand sidebar category &#x27;Integration&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/sample-application">Sample Application</a><button aria-label="Expand sidebar category &#x27;Sample Application&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/Extreal.Guide/en/next/category/learning">Learning</a><button aria-label="Collapse sidebar category &#x27;Learning&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Extreal.Guide/en/next/learning/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Extreal.Guide/en/next/learning/core">Core</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Extreal.Guide/en/next/learning/chat.vivox">Chat using Vivox</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Extreal.Guide/en/next/learning/multiplay.ngo">Multiplay using Netcode for GameObjects</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Extreal.Guide/en/next/category/legal">Legal</a><button aria-label="Expand sidebar category &#x27;Legal&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is unreleased documentation for <!-- -->Extreal<!-- --> <b>Next</b> version.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/Extreal.Guide/en/learning/chat.vivox">latest version</a></b> (<!-- -->1.2.0<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/Extreal.Guide/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/Extreal.Guide/en/next/category/learning"><span itemprop="name">Learning</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Chat using Vivox</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: Next</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1 id="chat-using-vivox">Chat using Vivox</h1>
<p>In this section, you will learn about the <a href="/Extreal.Guide/en/next/integration/chat.vivox">Vivox wrapper</a>.</p>
<ul>
<li>Approximate learning time<!-- -->
<ul>
<li>60 min.</li>
</ul>
</li>
<li>Unity Version<!-- -->
<ul>
<li>2022.3.2f1</li>
</ul>
</li>
</ul>
<p>The Vivox wrapper learning process uses a project prepared for learning.
This learning project is based on the application architecture built in the Core learning.
If you have not learned Core, it is recommended that you learn <a href="/Extreal.Guide/en/next/learning/core">Learning Core</a> before learning this project.</p>
<p>Using the learning project with the Vivox wrapper set up, we will add an implementation of the application to allow text and voice chat in virtual space.</p>
<p>You will need to have an application on the <a href="https://developer.vivox.com/">Vivox Developer Portal</a> to connect to from the client to do this learning.
Please create an application on the <a href="https://developer.vivox.com/">Vivox Developer Portal</a> before starting the following hands-on activities.</p>
<h2 id="prepare-project">Prepare project</h2>
<admonition title="step" type="info"><p>First, prepare your project.</p></admonition>
<p>Clone the learning project.</p>
<pre><code class="language-text">https://github.com/extreal-dev/Extreal.Learning.Chat.Vivox.git
</code></pre>
<p>Open the cloned project in the Unity editor.
If the message &quot;Link your Unity project&quot; appears, close it without setting it.</p>
<admonition title="step" type="info"><p>Review the project contents.</p></admonition>
<p>The <code>ExtrealCoreLearning</code> directory in the Assets directory is the directory that contains the assets for the application.
We control the dependent packages by creating an Assembly Definition with the same name as the directory name.</p>
<p>The state of the <code>ExtrealCoreLearning</code> directory is as follows.</p>
<ul>
<li>The title screen and virtual space have already been created</li>
<li>The virtual space uses assets provided by <a href="http://u3d.as/2z1r">Starter Assets - Third Person Character Controller</a></li>
<li>UIs for text chat and voice chat have already been created in the virtual space</li>
<li>Text chat and voice chat are realized in the virtual space</li>
</ul>
<admonition title="step" type="info"><p>Let&#x27;s run the application to make sure there are no problems with the project.</p></admonition>
<p>Run the <code>App</code> scene in the App directory.
It is successful if you can press the Go button on the title screen to move to the virtual space.</p>
<p><img alt="Project success" src="/Extreal.Guide/en/assets/images/learning-vivox-project-success-88c1b0af63143a5126da12fa32dd3909.png" width="1053" height="507"></p>
<p>Try the text chat UI.
Enter an appropriate message in the input field and press the Send button.
The message will appear on the screen.</p>
<p><img alt="Text chat" src="/Extreal.Guide/en/assets/images/learning-vivox-ui-textchat-3662f76ee0ea1d1f507e32d63e982d96.png" width="1137" height="405"></p>
<p>The Voice Chat UI provides a button to toggle mute.
Press the Voice button in the lower left corner of the screen.
The color of the button changes according to the mute status.
Red indicates unmuted and gray indicates muted.</p>
<p><img alt="Voice chat" src="/Extreal.Guide/en/assets/images/learning-vivox-ui-voicechat-da8083869343839e747b2718e8de9152.png" width="1086" height="413"></p>
<p>Check the following directories for UI implementations of text and voice chat.</p>
<ul>
<li>Text chat<!-- -->
<pre><code class="language-text">ExtrealCoreLearning/TextChatControl
</code></pre>
</li>
<li>Voice chat<!-- -->
<pre><code class="language-text">ExtrealCoreLearning/VoiceChatControl
</code></pre>
</li>
</ul>
<p>We will add an implementation to allow text and voice chat in the virtual space.</p>
<h2 id="add-vivoxclient">Add VivoxClient</h2>
<p>First, prepare a VivoxClient.
Since only one VivoxClient needs to exist in the application, it should be included in the App scene so that it can be reused even if the space increases.</p>
<admonition title="step" type="info"><p>Create a ScriptableObject that generates the VivoxAppConfig.</p></admonition>
<p><img alt="VivoxAppConfig" src="/Extreal.Guide/en/assets/images/learning-vivox-vivoxclient-vivoxappconfig-3523d98a403e4f95dd663cda5afd47ac.png" width="917" height="298"></p>
<ul>
<li>Create a ChatConfig script that creates a VivoxAppConfig object in the App directory, referring to <a href="/Extreal.Guide/en/next/integration/chat.vivox#settings">Settings in the Vivox wrapper</a>.</li>
<li>Create a ChatConfig object from the Create Asset menu and set the connection information to Vivox in the inspector.</li>
</ul>
<admonition title="step" type="info"><p>Initialize VivoxClient by changing AppScope.</p></admonition>
<p>Set VivoxAppConfig to VivoxClient using VContainer.</p>
<pre><code class="language-csharp">using Extreal.Core.Logging;
using Extreal.Core.StageNavigation;
// highlight-start
using Extreal.Integration.Chat.Vivox;
// highlight-end
using UnityEngine;
using VContainer;
using VContainer.Unity;

namespace ExtrealCoreLearning.App
{
    public class AppScope : LifetimeScope
    {
        [SerializeField] private StageConfig stageConfig;
        // highlight-start
        [SerializeField] private ChatConfig chatConfig;
        // highlight-end

        private static void InitializeApp()
        {
            // Omitted due to no changes
        }

        protected override void Awake()
        {
            // Omitted due to no changes
        }

        protected override void Configure(IContainerBuilder builder)
        {
            builder.RegisterComponent(stageConfig).AsImplementedInterfaces();
            builder.Register&lt;StageNavigator&lt;StageName, SceneName&gt;&gt;(Lifetime.Singleton);

            // highlight-start
            builder.RegisterComponent(chatConfig.ToVivoxAppConfig());
            builder.Register&lt;VivoxClient&gt;(Lifetime.Singleton);
            // highlight-end

            builder.RegisterEntryPoint&lt;AppPresenter&gt;();
        }
    }
}
</code></pre>
<p>Set the ChatConfig object to AppScope in the Inspector.</p>
<p><img alt="AppScope" src="/Extreal.Guide/en/assets/images/learning-vivox-appscope-vivoxappconfig-2bd62c46aab94edf4db9f71ec8015422.png" width="999" height="485"></p>
<admonition title="step" type="info"><p>Log into the Vivox server by changing AppPresenter.</p></admonition>
<p>In Vivox, log into the server and then join the channel.
You can log in at any time before joining a channel, so do it first.</p>
<pre><code class="language-csharp">using System.Threading;
using Cysharp.Threading.Tasks;
using Extreal.Core.StageNavigation;
// highlight-start
using Extreal.Integration.Chat.Vivox;
// highlight-end
using VContainer.Unity;

namespace ExtrealCoreLearning.App
{
    public class AppPresenter : IAsyncStartable
    {
        private StageNavigator&lt;StageName, SceneName&gt; stageNavigator;
        // highlight-start
        private VivoxClient vivoxClient;

        public AppPresenter
        (
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator,
            VivoxClient vivoxClient
        )
        // highlight-end
        {
            this.stageNavigator = stageNavigator;
            // highlight-start
            this.vivoxClient = vivoxClient;
            // highlight-end
        }

        public async UniTask StartAsync(CancellationToken cancellation)
        {
            // highlight-start
            vivoxClient.LoginAsync(new VivoxAuthConfig(nameof(ExtrealCoreLearning))).Forget();
            // highlight-end
            await stageNavigator.ReplaceAsync(StageName.TitleStage);
        }
    }
}
</code></pre>
<h2 id="add-text-chat">Add text chat</h2>
<p>Now that VivoxClient is ready, we will add text chat.</p>
<admonition title="step" type="info"><p>Create a Model script that provides the logic for text chat.</p></admonition>
<p>Create it in the ExtrealCoreLearning/TextChatControl directory.
It provides for joining and leaving the channel, sending and receiving messages.</p>
<pre><code class="language-csharp">using System;
using Cysharp.Threading.Tasks;
using Extreal.Core.Common.System;
using Extreal.Integration.Chat.Vivox;
using UniRx;
using VivoxUnity;

namespace ExtrealCoreLearning.TextChatControl
{
    public class TextChatChannel : DisposableBase
    {
        private readonly VivoxClient vivoxClient;
        private readonly string channelName;

        private ChannelId channelId;

        private readonly CompositeDisposable disposables = new CompositeDisposable();
        
        public IObservable&lt;string&gt; OnMessageReceived
            =&gt; vivoxClient.OnTextMessageReceived.Select(channelTextMessage =&gt; channelTextMessage.Message);

        public TextChatChannel(VivoxClient vivoxClient, string channelName)
        {
            this.vivoxClient = vivoxClient;
            this.channelName = channelName;
        }

        public async UniTask JoinAsync()
            =&gt; channelId = await vivoxClient.ConnectAsync(
                new VivoxChannelConfig(channelName, ChatType.TextOnly, transmissionSwitch: false));

        public void Leave()
        {
            if (ChannelId.IsNullOrEmpty(channelId))
            {
                return;
            }
            vivoxClient.Disconnect(channelId);
        }

        public void SendMessage(string message)
            =&gt; vivoxClient.SendTextMessage(message, channelId);

        protected override void ReleaseManagedResources()
            =&gt; disposables.Dispose();
    }
}
</code></pre>
<admonition title="step" type="info"><p>Change TextChatControlPresenter to use TextChatChannel.</p></admonition>
<p>A TextChatChannel is created and the user joins the channel when entering the stage, and he/she leaves the channel when exiting the stage.
Sending and receiving messages are realized by mapping TextChatControlView of the View script to TextChatChannel of the Model script.</p>
<pre><code class="language-csharp">// highlight-start
using Cysharp.Threading.Tasks;
// highlight-end
using Extreal.Core.Common.System;
// highlight-start
using Extreal.Core.StageNavigation;
using Extreal.Integration.Chat.Vivox;
using ExtrealCoreLearning.App;
// highlight-end
using UniRx;
using VContainer.Unity;

namespace ExtrealCoreLearning.TextChatControl
{
    public class TextChatControlPresenter : DisposableBase, IInitializable
    {
        // highlight-start
        private readonly StageNavigator&lt;StageName, SceneName&gt; stageNavigator;
        private readonly VivoxClient vivoxClient;
        // highlight-end
        private readonly TextChatControlView textChatControlView;
        private readonly CompositeDisposable disposables = new CompositeDisposable();
        // highlight-start
        private TextChatChannel textChatChannel;
        private readonly CompositeDisposable stageDisposables = new CompositeDisposable();
        // highlight-end

        // highlight-start
        public TextChatControlPresenter(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator,
            VivoxClient vivoxClient,
            TextChatControlView textChatControlView)
        // highlight-end
        {
            // highlight-start
            this.stageNavigator = stageNavigator;
            this.vivoxClient = vivoxClient;
            // highlight-end
            this.textChatControlView = textChatControlView;
        }

        public void Initialize()
        {
            // highlight-start
            stageNavigator.OnStageTransitioned
                .Subscribe(OnStageEntered).AddTo(disposables);

            stageNavigator.OnStageTransitioning
                .Subscribe(OnStageExiting).AddTo(disposables);
            // highlight-end

            textChatControlView.OnSendButtonClicked.Subscribe(message =&gt;
            {
                // highlight-start
                textChatChannel.SendMessage(message);
                // highlight-end
            }).AddTo(disposables);
        }

        // highlight-start
        private void OnStageEntered(StageName stageName)
        {
            textChatChannel = new TextChatChannel(vivoxClient, $&quot;TextChat-{stageName}&quot;);
            textChatChannel.OnMessageReceived.Subscribe(message =&gt;
            {
                textChatControlView.ShowTextChatMessage(message);
            }).AddTo(stageDisposables);
            textChatChannel.JoinAsync().Forget();
        }

        private void OnStageExiting(StageName stageName)
        {
            textChatChannel.Leave();
            textChatChannel.Dispose();
            stageDisposables.Clear();
        }
        // highlight-end

        protected override void ReleaseManagedResources()
        {
            // highlight-start
            stageDisposables.Dispose();
            // highlight-end
            disposables.Dispose();
        }
    }
}
</code></pre>
<admonition title="step" type="info"><p>Play text chat.</p></admonition>
<p>Use <a href="https://github.com/VeriorPies/ParrelSync">ParrelSync</a> to check how text chat works.
Since ParrelSync is installed in the project, open multiple Unity editors using ParrelSync and play with them.</p>
<p><img alt="ParrelSync" src="/Extreal.Guide/en/assets/images/learning-ngo-parrelsync-d1b8359df842b754142e0ef6c2a2c187.png" width="1185" height="505"></p>
<p>Run the App scene.
It may take some time to connect to Vivox, so if you send a message immediately after execution, it may not be sent.
If the message does not respond, please send a message after a short wait.</p>
<p>If the message is sent to all running applications, it is successful.</p>
<h2 id="add-base-class">Add base class</h2>
<p>Before adding voice chat, we will cut out the common processing in the Base class since the Model and Presenter scripts for text and voice chat have many parts in common.
The common processing is as follows.</p>
<ul>
<li>Model script<!-- -->
<ul>
<li>Joining and leaving a channel</li>
</ul>
</li>
<li>Presenter script<!-- -->
<ul>
<li>Creates a TextChatChannel and joins the channel when entering the stage, and leaves the channel when exiting the stage</li>
</ul>
</li>
</ul>
<admonition title="step" type="info"><p>Create a Base class for the Model script.</p></admonition>
<p>Create it in the App directory.</p>
<pre><code class="language-csharp">using Cysharp.Threading.Tasks;
using Extreal.Core.Common.System;
using Extreal.Integration.Chat.Vivox;
using UniRx;
using VivoxUnity;

namespace ExtrealCoreLearning.App
{
    public abstract class ChatChannelBase : DisposableBase
    {
        protected readonly VivoxClient VivoxClient;
        protected readonly string ChannelName;
        protected ChannelId ChannelId;

        protected readonly CompositeDisposable Disposables = new CompositeDisposable();

        protected ChatChannelBase(VivoxClient vivoxClient, string channelName)
        {
            VivoxClient = vivoxClient;
            ChannelName = channelName;
        }

        public async UniTask JoinAsync()
            =&gt; ChannelId = await VivoxClient.ConnectAsync(CreateChannelConfig(ChannelName));

        protected abstract VivoxChannelConfig CreateChannelConfig(string channelName);

        public void Leave()
        {
            if (ChannelId.IsNullOrEmpty(ChannelId))
            {
                return;
            }

            VivoxClient.Disconnect(ChannelId);
        }

        protected override void ReleaseManagedResources()
            =&gt; Disposables.Dispose();
    }
}
</code></pre>
<admonition title="step" type="info"><p>Change TextChatChannel to use Base class.</p></admonition>
<pre><code class="language-csharp">using System;
using Cysharp.Threading.Tasks;
using Extreal.Integration.Chat.Vivox;
using ExtrealCoreLearning.App;
using UniRx;

namespace ExtrealCoreLearning.TextChatControl
{
    public class TextChatChannel : ChatChannelBase
    {
        public IObservable&lt;string&gt; OnMessageReceived
            =&gt; VivoxClient.OnTextMessageReceived.Select(channelTextMessage =&gt; channelTextMessage.Message);

        public TextChatChannel(VivoxClient vivoxClient, string channelName) : base(vivoxClient, channelName)
        {
        }

        protected override VivoxChannelConfig CreateChannelConfig(string channelName)
            =&gt; new VivoxChannelConfig(channelName, ChatType.TextOnly, transmissionSwitch: false);

        public void SendMessage(string message)
            =&gt; VivoxClient.SendTextMessage(message, ChannelId);
    }
}
</code></pre>
<admonition title="step" type="info"><p>Create a Base class for the Presenter script.</p></admonition>
<p>Create it in the App directory.</p>
<pre><code class="language-csharp">using Extreal.Core.Common.System;
using Extreal.Core.StageNavigation;
using UniRx;
using VContainer.Unity;

namespace ExtrealCoreLearning.App
{
    public abstract class ControlPresenterBase : DisposableBase, IInitializable
    {
        private readonly StageNavigator&lt;StageName, SceneName&gt; stageNavigator;
        private readonly CompositeDisposable sceneDisposables = new CompositeDisposable();
        private CompositeDisposable stageDisposables = new CompositeDisposable();

        protected ControlPresenterBase(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator)
        {
            this.stageNavigator = stageNavigator;
        }

        public void Initialize()
        {
            stageNavigator.OnStageTransitioned.Subscribe(stageName =&gt;
            {
                OnStageEntered(stageName, stageDisposables);
            }).AddTo(sceneDisposables);

            stageNavigator.OnStageTransitioning.Subscribe(stageName =&gt;
            {
                OnStageExiting(stageName);
                stageDisposables.Clear();
            }).AddTo(sceneDisposables);

            Initialize(stageNavigator, sceneDisposables);
        }

        protected abstract void Initialize(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator, CompositeDisposable sceneDisposables);

        protected abstract void OnStageEntered(
            StageName stageName, CompositeDisposable stageDisposables);

        protected abstract void OnStageExiting(StageName stageName);

        protected override void ReleaseManagedResources()
        {
            stageDisposables.Dispose();
            sceneDisposables.Dispose();
        }
    }
}
</code></pre>
<admonition title="step" type="info"><p>Change TextChatControlPresenter to use Base class.</p></admonition>
<pre><code class="language-csharp">using Cysharp.Threading.Tasks;
using Extreal.Core.StageNavigation;
using Extreal.Integration.Chat.Vivox;
using ExtrealCoreLearning.App;
using UniRx;

namespace ExtrealCoreLearning.TextChatControl
{
    public class TextChatControlPresenter : ControlPresenterBase
    {
        private readonly VivoxClient vivoxClient;
        private readonly TextChatControlView textChatControlView;
        private TextChatChannel textChatChannel;

        public TextChatControlPresenter(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator,
            VivoxClient vivoxClient,
            TextChatControlView textChatControlView) : base(stageNavigator)
        {
            this.vivoxClient = vivoxClient;
            this.textChatControlView = textChatControlView;
        }

        protected override void Initialize(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator,
            CompositeDisposable sceneDisposables)
        {
            textChatControlView.OnSendButtonClicked
                .Subscribe(message =&gt;
                {
                    textChatChannel.SendMessage(message);
                }).AddTo(sceneDisposables);
        }

        protected override void OnStageEntered(
            StageName stageName,
            CompositeDisposable stageDisposables)
        {
            textChatChannel = new TextChatChannel(vivoxClient, $&quot;TextChat-{stageName}&quot;);
            textChatChannel.OnMessageReceived
                .Subscribe(message =&gt;
                {
                    textChatControlView.ShowTextChatMessage(message);
                }).AddTo(stageDisposables);
            textChatChannel.JoinAsync().Forget();
        }

        protected override void OnStageExiting(StageName stageName)
        {
            textChatChannel.Leave();
            textChatChannel.Dispose();
        }
    }
}
</code></pre>
<p>If you can run the App scene and play text chat as before the change, it is successful.</p>
<h2 id="add-voice-chat">Add voice chat</h2>
<p>We will add voice chat.</p>
<admonition title="step" type="info"><p>Change the VoiceChatChannel in the Model script to use the Base class and VivoxClient.</p></admonition>
<p>This uses VivoxClient to control the mute of the input device.</p>
<pre><code class="language-csharp">using System;
using Cysharp.Threading.Tasks;
using Extreal.Integration.Chat.Vivox;
using ExtrealCoreLearning.App;
using UniRx;

namespace ExtrealCoreLearning.VoiceChatControl
{
    public class VoiceChatChannel : ChatChannelBase
    {
        public IObservable&lt;bool&gt; IsMute =&gt; isMute.AddTo(Disposables);
        private ReactiveProperty&lt;bool&gt; isMute = new ReactiveProperty&lt;bool&gt;(true);

        public VoiceChatChannel(VivoxClient vivoxClient, string channelName) : base(vivoxClient, channelName)
            =&gt; SetMuteAsync(true).Forget();

        protected override VivoxChannelConfig CreateChannelConfig(string channelName)
            =&gt; new VivoxChannelConfig(channelName, ChatType.AudioOnly);

        public UniTask ToggleMuteAsync()
            =&gt; SetMuteAsync(!isMute.Value);

        private async UniTask SetMuteAsync(bool muted)
        {
            var audioInputDevices = await VivoxClient.GetAudioInputDevicesAsync();
            audioInputDevices.Muted = muted;
            isMute.Value = muted;
        }
    }
}
</code></pre>
<admonition title="step" type="info"><p>Modify VoiceChatControlPresenter to use Base class and VoiceChatChannel.</p></admonition>
<pre><code class="language-csharp">using Cysharp.Threading.Tasks;
using Extreal.Core.StageNavigation;
using Extreal.Integration.Chat.Vivox;
using ExtrealCoreLearning.App;
using UniRx;

namespace ExtrealCoreLearning.VoiceChatControl
{
    public class VoiceChatControlPresenter : ControlPresenterBase
    {
        private readonly VivoxClient vivoxClient;
        private readonly VoiceChatControlView voiceChatControlView;
        private VoiceChatChannel voiceChatChannel;

        public VoiceChatControlPresenter(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator,
            VivoxClient vivoxClient,
            VoiceChatControlView voiceChatControlView) : base(stageNavigator)
        {
            this.vivoxClient = vivoxClient;
            this.voiceChatControlView = voiceChatControlView;
        }

        protected override void Initialize(
            StageNavigator&lt;StageName, SceneName&gt; stageNavigator, CompositeDisposable sceneDisposables)
        {
            voiceChatControlView.OnVoiceButtonClicked.Subscribe(_ =&gt;
            {
                voiceChatChannel.ToggleMuteAsync().Forget();
            }).AddTo(sceneDisposables);
        }

        protected override void OnStageEntered(StageName stageName, CompositeDisposable stageDisposables)
        {
            voiceChatChannel = new VoiceChatChannel(vivoxClient, $&quot;VoiceChat-{stageName}&quot;);
            voiceChatChannel.IsMute.Subscribe(isMute =&gt;
            {
                voiceChatControlView.toggleMute(isMute);
            }).AddTo(stageDisposables);
            voiceChatChannel.JoinAsync().Forget();
        }

        protected override void OnStageExiting(StageName stageName)
        {
            voiceChatChannel.Leave();
            voiceChatChannel.Dispose();
        }
    }
}
</code></pre>
<admonition title="step" type="info"><p>Play voice chat.</p></admonition>
<p>Open and play multiple Unity editors using ParrelSync.</p>
<p>Run the App scene.
Toggle mute, if the voice is sent to all running applications, it is successful.</p>
<h2 id="next-step">Next Step</h2>
<p>This concludes our hands-on with the Vivox wrapper.
Thank you for your time.</p>
<p>Through this hands-on, you have experienced how to create text and voice chats using the <a href="/Extreal.Guide/en/next/integration/chat.vivox">Vivox wrapper</a>.
As a next step, you might be interested in how the Vivox wrapper can be used in a more serious application.
To meet your expectations, we provide <a href="../category/sample-application">Sample Application</a> as an example of a full-scale implementation.
Please take a look at <a href="../category/sample-application">Sample Application</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Extreal.Guide/en/next/learning/core"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Core</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Extreal.Guide/en/next/learning/multiplay.ngo"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Multiplay using Netcode for GameObjects</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prepare-project" class="table-of-contents__link toc-highlight">Prepare project</a></li><li><a href="#add-vivoxclient" class="table-of-contents__link toc-highlight">Add VivoxClient</a></li><li><a href="#add-text-chat" class="table-of-contents__link toc-highlight">Add text chat</a></li><li><a href="#add-base-class" class="table-of-contents__link toc-highlight">Add base class</a></li><li><a href="#add-voice-chat" class="table-of-contents__link toc-highlight">Add voice chat</a></li><li><a href="#next-step" class="table-of-contents__link toc-highlight">Next Step</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">License</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apache License 2.0<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Feedback</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/extreal-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Used by</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.buralit.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">BURALIT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item">
                    <a class="footer__link-item" href="javascript:void(0);" onclick="goTermsOfUse()">Terms of Use</a>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 TIS, Inc. Built with Docusaurus.<br><small>The names of products or services appearing on this site are trademarks or registered trademarks of the respective companies.</small></div></div></div></footer></div>
</body>
</html>